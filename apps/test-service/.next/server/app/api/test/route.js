(()=>{var e={};e.id=450,e.ids=[450],e.modules={483:()=>{},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1204:e=>{"use strict";e.exports=require("string_decoder")},1630:e=>{"use strict";e.exports=require("http")},1820:e=>{"use strict";e.exports=require("os")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3258:(e,t,s)=>{"use strict";s.d(t,{A:()=>h});var r=s(9668),i=s.n(r);s(6344);var n=s(3873),o=s.n(n),a=s(9021),u=s.n(a);let l=o().join(process.cwd(),"logs");u().existsSync(l)||u().mkdirSync(l,{recursive:!0});let c=i().format.combine(i().format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),i().format.printf(({timestamp:e,level:t,message:s})=>`${e} [${t.toUpperCase()}]: ${s}`)),m=i().format.combine(i().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),i().format.colorize({all:!0}),i().format.printf(({timestamp:e,level:t,message:s})=>{let r=t.padEnd(15);return`ğŸ•’ ${e} | ${r} | ${s}`})),p=new(i()).transports.DailyRotateFile({filename:o().join(l,"%DATE%.log"),datePattern:"YYYY-MM-DD",maxSize:"20m",maxFiles:"14d",format:c}),d=new(i()).transports.Console({format:m}),h=i().createLogger({level:"info",transports:[d,p]})},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4735:e=>{"use strict";e.exports=require("events")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4907:()=>{},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},5696:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>A,routeModule:()=>$,serverHooks:()=>y,workAsyncStorage:()=>k,workUnitAsyncStorage:()=>v});var r={};s.r(r),s.d(r,{GET:()=>g});var i=s(9227),n=s(9044),o=s(1131),a=s(7642),u=s(5511);let l={randomUUID:u.randomUUID},c=new Uint8Array(256),m=c.length,p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));let d=function(e,t,s){if(l.randomUUID&&!t&&!e)return l.randomUUID();let r=(e=e||{}).random??e.rng?.()??(m>c.length-16&&((0,u.randomFillSync)(c),m=0),c.slice(m,m+=16));if(r.length<16)throw Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((s=s||0)<0||s+16>t.length)throw RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[s+e]=r[e];return t}return function(e,t=0){return(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase()}(r)};var h=s(3258);class x{constructor(e,t){if(e<=0||t<=0)throw Error("slotCountå’Œintervalå¿…é¡»å¤§äº0");this.slots=Array(e).fill(null).map(()=>new Map),this.currentSlot=0,this.interval=t,this.timer=null,this.isRunning=!1,h.A.info(`TimeWheel åˆå§‹åŒ–: ${e} æ§½ä½, ${t}ms é—´éš”`)}addTask(e,t,s=0){let r=t||d(),i={...e,id:r,executionCount:s},n=this.calculateSlotIndex(e.delay);this.slots[n].set(r,i);let o=e.maxExecutions?`, æœ€å¤§æ‰§è¡Œæ¬¡æ•°: ${e.maxExecutions}, å½“å‰æ‰§è¡Œæ¬¡æ•°: ${s}`:"";return h.A.debug(`æ·»åŠ ä»»åŠ¡: ${r}, å»¶è¿Ÿ: ${e.delay}ms, æ§½ä½: ${n}, é‡å¤: ${e.repeat}${o}`),this.isRunning||setImmediate(()=>{this.ensureRunning()}),r}calculateSlotIndex(e){return(this.currentSlot+Math.floor(e/this.interval))%this.slots.length}ensureRunning(){this.isRunning||(h.A.info("æ—¶é—´è½®æœªè¿è¡Œï¼Œå¯åŠ¨æ—¶é—´è½®"),this.start())}start(){this.isRunning||(this.isRunning=!0,h.A.info("æ—¶é—´è½®å¼€å§‹è¿è¡Œ"),this.tick())}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.isRunning=!1,h.A.info("æ—¶é—´è½®åœæ­¢è¿è¡Œ")}hasRemainingTasks(){return this.slots.some(e=>e.size>0)}tick(){h.A.debug(`æ—¶é—´è½®è½¬åŠ¨: å½“å‰æ§½ä½ ${this.currentSlot}`);let e=this.slots[this.currentSlot],t=e.size;t>0&&(h.A.debug(`æ‰§è¡Œæ§½ä½ ${this.currentSlot} çš„ ${t} ä¸ªä»»åŠ¡`),this.executeTasks(e)),e.clear(),this.currentSlot=(this.currentSlot+1)%this.slots.length,this.scheduleNextTick()}executeTasks(e){for(let t of Array.from(e.values())){let e=t.executionCount+1;try{h.A.debug(`æ‰§è¡Œä»»åŠ¡: ${t.id}, æ‰§è¡Œæ¬¡æ•°: ${e}`),t.callback()}catch(e){h.A.error(`æ‰§è¡Œä»»åŠ¡ ${t.id} æ—¶å‘ç”Ÿé”™è¯¯: ${e instanceof Error?e.message:e}`)}t.repeat&&(!t.maxExecutions||e<t.maxExecutions?(h.A.debug(`é‡å¤ä»»åŠ¡: ${t.id}, å»¶è¿Ÿ: ${t.delay}ms, æ‰§è¡Œæ¬¡æ•°: ${e}${t.maxExecutions?`/${t.maxExecutions}`:""}`),this.addTask({delay:t.delay,callback:t.callback,repeat:!0,maxExecutions:t.maxExecutions},t.id,e)):t.maxExecutions&&e>=t.maxExecutions&&h.A.info(`ä»»åŠ¡ ${t.id} å·²è¾¾åˆ°æœ€å¤§æ‰§è¡Œæ¬¡æ•° ${t.maxExecutions}ï¼Œåœæ­¢é‡å¤æ‰§è¡Œ`))}}scheduleNextTick(){this.hasRemainingTasks()?this.timer=setTimeout(()=>{setImmediate(()=>this.tick())},this.interval):(h.A.info("æ²¡æœ‰å‰©ä½™ä»»åŠ¡ï¼Œåœæ­¢æ—¶é—´è½®"),this.stop())}removeTask(e){let t=!1;for(let s of this.slots)if(s.has(e)){s.delete(e),t=!0,h.A.debug(`ç§»é™¤ä»»åŠ¡: ${e}`);break}return t&&!this.hasRemainingTasks()&&(h.A.info("ç§»é™¤ä»»åŠ¡åæ²¡æœ‰å‰©ä½™ä»»åŠ¡ï¼Œåœæ­¢æ—¶é—´è½®"),this.stop()),t}}let f=null;async function g(e){try{let t=e.nextUrl.searchParams;console.log(t);let s=(f||(f=new x(10,1e3)),f);for(let e=0;e<5;e++)s.addTask({delay:1e3+1e3*e,repeat:!0,callback:()=>{console.log(`Task ${e+1} executed at ${new Date().toLocaleTimeString()}`)}});return a.NextResponse.json({success:!0,message:"Time wheel started with interval: 250ms,"})}catch(e){return a.NextResponse.json({success:!1,message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let $=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/test/route",pathname:"/api/test",filename:"route",bundlePath:"app/api/test/route"},resolvedPagePath:"/Users/liushuo/code/ts-next-template/apps/test-service/app/api/test/route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:k,workUnitAsyncStorage:v,serverHooks:y}=$;function A(){return(0,o.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:v})}},7910:e=>{"use strict";e.exports=require("stream")},8354:e=>{"use strict";e.exports=require("util")},9021:e=>{"use strict";e.exports=require("fs")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[938,344],()=>s(5696));module.exports=r})();