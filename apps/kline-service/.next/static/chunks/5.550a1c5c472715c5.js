(()=>{var e={7606:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/kline_processor_bg.0425bbc7.wasm"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var _=t[r]={exports:{}},i=!0;try{e[r](_,_.exports,n),i=!1}finally{i&&delete t[r]}return _.exports}n.U=function(e){var t=new URL(e,"x:/"),n={};for(var r in t)n[r]=t[r];for(var r in n.href=e,n.pathname=e.replace(/[?#].*/,""),n.origin=n.protocol="",n.toString=n.toJSON=()=>e,n)Object.defineProperty(this,r,{enumerable:!0,configurable:!0,value:n[r]})},n.U.prototype=URL.prototype,n.p="/_next/",(()=>{"use strict";let e,t="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&t.decode();let r=null;function o(){return(null===r||0===r.byteLength)&&(r=new Uint8Array(e.memory.buffer)),r}function _(e,n){return e>>>=0,t.decode(o().subarray(e,e+n))}function i(t){let n=e.__externref_table_alloc();return e.__wbindgen_export_3.set(n,t),n}function a(t,n){try{return t.apply(this,n)}catch(n){let t=i(n);e.__wbindgen_exn_store(t)}}let s=0,l="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},c="function"==typeof l.encodeInto?function(e,t){return l.encodeInto(e,t)}:function(e,t){let n=l.encode(e);return t.set(n),{read:e.length,written:n.length}};function f(e,t,n){if(void 0===n){let n=l.encode(e),r=t(n.length,1)>>>0;return o().subarray(r,r+n.length).set(n),s=n.length,r}let r=e.length,_=t(r,1)>>>0,i=o(),a=0;for(;a<r;a++){let t=e.charCodeAt(a);if(t>127)break;i[_+a]=t}if(a!==r){0!==a&&(e=e.slice(a)),_=n(_,r,r=a+3*e.length,1)>>>0;let t=c(e,o().subarray(_+a,_+r));a+=t.written,_=n(_,r,a,1)>>>0}return s=a,_}let b=null;function g(){return(null===b||!0===b.buffer.detached||void 0===b.buffer.detached&&b.buffer!==e.memory.buffer)&&(b=new DataView(e.memory.buffer)),b}function u(t){let n=e.__wbindgen_export_3.get(t);return e.__externref_table_dealloc(t),n}let w="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>e.__wbg_klineprocess_free(t>>>0,1));class d{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,w.unregister(this),e}free(){let t=this.__destroy_into_raw();e.__wbg_klineprocess_free(t,0)}set_canvases(t,n,r){let o=e.klineprocess_set_canvases(this.__wbg_ptr,t,n,r);if(o[1])throw u(o[0])}draw_all(){let t=e.klineprocess_draw_all(this.__wbg_ptr);if(t[1])throw u(t[0])}handle_mouse_move(t,n){e.klineprocess_handle_mouse_move(this.__wbg_ptr,t,n)}get_cursor_style(t,n){let r,o;try{let i=e.klineprocess_get_cursor_style(this.__wbg_ptr,t,n);return r=i[0],o=i[1],_(i[0],i[1])}finally{e.__wbindgen_free(r,o,1)}}handle_mouse_leave(){return 0!==e.klineprocess_handle_mouse_leave(this.__wbg_ptr)}handle_wheel(t,n,r){e.klineprocess_handle_wheel(this.__wbg_ptr,t,n,r)}handle_mouse_down(t,n){return 0!==e.klineprocess_handle_mouse_down(this.__wbg_ptr,t,n)}handle_mouse_up(t,n){return 0!==e.klineprocess_handle_mouse_up(this.__wbg_ptr,t,n)}handle_mouse_drag(t,n){e.klineprocess_handle_mouse_drag(this.__wbg_ptr,t,n)}handle_click(t,n){return 0!==e.klineprocess_handle_click(this.__wbg_ptr,t,n)}constructor(t,n,r){let o=e.klineprocess_new(t,n,r);if(o[2])throw u(o[1]);return this.__wbg_ptr=o[0]>>>0,w.register(this,this.__wbg_ptr,this),this}}async function h(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"!=e.headers.get("Content-Type"))console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}let n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{let n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}async function y(t){var o,l;if(void 0!==e)return e;void 0!==t&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),void 0===t&&(t=new n.U(n(7606)));let c=function(){let t={};return t.wbg={},t.wbg.__wbg_beginPath_6de9eda64177d58a=function(e){e.beginPath()},t.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},t.wbg.__wbg_clearRect_4790e3611b42f068=function(e,t,n,r,o){e.clearRect(t,n,r,o)},t.wbg.__wbg_clip_005815dea515e201=function(e){e.clip()},t.wbg.__wbg_closePath_cf0e7130243e1083=function(e){e.closePath()},t.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,n){let r,o;try{r=t,o=n,console.error(_(t,n))}finally{e.__wbindgen_free(r,o,1)}},t.wbg.__wbg_fillRect_b1529535ac758d4c=function(e,t,n,r,o){e.fillRect(t,n,r,o)},t.wbg.__wbg_fillText_4b725baf76b6a837=function(){return a(function(e,t,n,r,o){e.fillText(_(t,n),r,o)},arguments)},t.wbg.__wbg_fill_eb166c2df67ecae7=function(e){e.fill()},t.wbg.__wbg_getContext_f65a0debd1e8f8e8=function(){return a(function(e,t,n){let r=e.getContext(_(t,n));return null==r?0:i(r)},arguments)},t.wbg.__wbg_globalAlpha_d09f513957912176=function(e){return e.globalAlpha},t.wbg.__wbg_height_e3c322f23d99ad2f=function(e){return e.height},t.wbg.__wbg_instanceof_Memory_111add5588accff2=function(e){let t;try{t=e instanceof WebAssembly.Memory}catch(e){t=!1}return t},t.wbg.__wbg_instanceof_OffscreenCanvasRenderingContext2d_a070fdde7ba760a3=function(e){let t;try{t=e instanceof OffscreenCanvasRenderingContext2D}catch(e){t=!1}return t},t.wbg.__wbg_length_a446193dc22c12f8=function(e){return e.length},t.wbg.__wbg_lineTo_04b5a9c687eccd70=function(e,t,n){e.lineTo(t,n)},t.wbg.__wbg_log_b46a0b216df7cf84=function(e,t){console.log(_(e,t))},t.wbg.__wbg_moveTo_1e871c64cf5d1fc1=function(e,t,n){e.moveTo(t,n)},t.wbg.__wbg_new_78c8a92080461d08=function(e){return new Float64Array(e)},t.wbg.__wbg_new_78feb108b6472713=function(){return[]},t.wbg.__wbg_new_8a6f238a6ece86ea=function(){return Error()},t.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},t.wbg.__wbg_newwithbyteoffsetandlength_93c8e0c1a479fa1a=function(e,t,n){return new Float64Array(e,t>>>0,n>>>0)},t.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(e,t,n){return new Uint8Array(e,t>>>0,n>>>0)},t.wbg.__wbg_newwithlength_5ebc38e611488614=function(e){return new Float64Array(e>>>0)},t.wbg.__wbg_of_66b3ee656cbd962b=function(e,t){return Array.of(e,t)},t.wbg.__wbg_quadraticCurveTo_d0e2225e49394b7a=function(e,t,n,r,o){e.quadraticCurveTo(t,n,r,o)},t.wbg.__wbg_rect_00c560f0cc92818c=function(e,t,n,r,o){e.rect(t,n,r,o)},t.wbg.__wbg_restore_1ef50af0835a4649=function(e){e.restore()},t.wbg.__wbg_save_5f563096e64939da=function(e){e.save()},t.wbg.__wbg_setLineDash_0e3f3e194352a774=function(){return a(function(e,t){e.setLineDash(t)},arguments)},t.wbg.__wbg_set_65595bdd868b3009=function(e,t,n){e.set(t,n>>>0)},t.wbg.__wbg_setfillStyle_cb059a69ce15cc28=function(e,t,n){e.fillStyle=_(t,n)},t.wbg.__wbg_setfont_4c3584ef2f5c9f7e=function(e,t,n){e.font=_(t,n)},t.wbg.__wbg_setglobalAlpha_3018cc44e3ab2d57=function(e,t){e.globalAlpha=t},t.wbg.__wbg_setheight_433680330c9420c3=function(e,t){e.height=t>>>0},t.wbg.__wbg_setimageSmoothingEnabled_15335584d0f077b6=function(e,t){e.imageSmoothingEnabled=0!==t},t.wbg.__wbg_setlineCap_3a3987ad3f03b31d=function(e,t,n){e.lineCap=_(t,n)},t.wbg.__wbg_setlineJoin_79ca64e7e9efaff7=function(e,t,n){e.lineJoin=_(t,n)},t.wbg.__wbg_setlineWidth_3c8b7156949a9f4b=function(e,t){e.lineWidth=t},t.wbg.__wbg_setshadowBlur_55636e14cc608483=function(e,t){e.shadowBlur=t},t.wbg.__wbg_setshadowColor_6e6d8ffdd901b1b4=function(e,t,n){e.shadowColor=_(t,n)},t.wbg.__wbg_setshadowOffsetX_a2bf8df2ff417742=function(e,t){e.shadowOffsetX=t},t.wbg.__wbg_setshadowOffsetY_3a6168755a1f2781=function(e,t){e.shadowOffsetY=t},t.wbg.__wbg_setstrokeStyle_070920f27992b9a6=function(e,t,n){e.strokeStyle=_(t,n)},t.wbg.__wbg_settextAlign_a6b56ad508184ec8=function(e,t,n){e.textAlign=_(t,n)},t.wbg.__wbg_settextBaseline_7fb1acb93a0c121a=function(e,t,n){e.textBaseline=_(t,n)},t.wbg.__wbg_setwidth_660ca581e3fbe279=function(e,t){e.width=t>>>0},t.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,n){let r=f(n.stack,e.__wbindgen_malloc,e.__wbindgen_realloc),o=s;g().setInt32(t+4,o,!0),g().setInt32(t+0,r,!0)},t.wbg.__wbg_strokeRect_758dd38f99a9581f=function(e,t,n,r,o){e.strokeRect(t,n,r,o)},t.wbg.__wbg_stroke_44080cc2554b4436=function(e){e.stroke()},t.wbg.__wbg_timeEnd_c7b7463c4f4acfbc=function(e,t){console.timeEnd(_(e,t))},t.wbg.__wbg_time_7aaed348524f10df=function(e,t){console.time(_(e,t))},t.wbg.__wbg_width_8fe4e8f77479c2a6=function(e){return e.width},t.wbg.__wbindgen_debug_string=function(t,n){let r=f(function e(t){let n,r=typeof t;if("number"==r||"boolean"==r||null==t)return"".concat(t);if("string"==r)return'"'.concat(t,'"');if("symbol"==r){let e=t.description;return null==e?"Symbol":"Symbol(".concat(e,")")}if("function"==r){let e=t.name;return"string"==typeof e&&e.length>0?"Function(".concat(e,")"):"Function"}if(Array.isArray(t)){let n=t.length,r="[";n>0&&(r+=e(t[0]));for(let o=1;o<n;o++)r+=", "+e(t[o]);return r+"]"}let o=/\[object ([^\]]+)\]/.exec(toString.call(t));if(!o||!(o.length>1))return toString.call(t);if("Object"==(n=o[1]))try{return"Object("+JSON.stringify(t)+")"}catch(e){return"Object"}return t instanceof Error?"".concat(t.name,": ").concat(t.message,"\n").concat(t.stack):n}(n),e.__wbindgen_malloc,e.__wbindgen_realloc),o=s;g().setInt32(t+4,o,!0),g().setInt32(t+0,r,!0)},t.wbg.__wbindgen_init_externref_table=function(){let t=e.__wbindgen_export_3,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},t.wbg.__wbindgen_memory=function(){return e.memory},t.wbg.__wbindgen_number_new=function(e){return e},t.wbg.__wbindgen_string_get=function(t,n){let r="string"==typeof n?n:void 0;var o=null==r?0:f(r,e.__wbindgen_malloc,e.__wbindgen_realloc),_=s;g().setInt32(t+4,_,!0),g().setInt32(t+0,o,!0)},t.wbg.__wbindgen_string_new=function(e,t){return _(e,t)},t.wbg.__wbindgen_throw=function(e,t){throw Error(_(e,t))},t.wbg.__wbindgen_typeof=function(e){return typeof e},t}();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));let{instance:u,module:w}=await h(await t,c);return o=u,l=w,e=o.exports,y.__wbindgen_wasm_module=l,b=null,r=null,e.__wbindgen_start(),e}let p=null,m=null,k=!1,v=null;async function W(e){if(k)return void console.warn("[Worker] 已经在初始化中，忽略重复请求");k=!0;try{console.time("[Worker] 完整初始化流程"),console.log("[Worker] 开始初始化 WASM..."),console.time("[Worker] 加载 WASM 模块"),await y({module_or_path:e.wasmPath}),console.timeEnd("[Worker] 加载 WASM 模块");let t=new Uint8Array(e.buffer);console.log("[Worker] 收到数据: ".concat(t.length," 字节"));let n=Math.ceil(t.length/65536);console.log("[Worker] 数据需要 ".concat(n," WASM 内存页")),console.time("[Worker] 分配 WASM 内存"),m=new WebAssembly.Memory({initial:n+2,maximum:Math.max((n+2)*2,1024),shared:!1}),console.timeEnd("[Worker] 分配 WASM 内存"),console.time("[Worker] 复制数据到 WASM 内存"),new Uint8Array(m.buffer,0,t.length).set(t),console.timeEnd("[Worker] 复制数据到 WASM 内存"),console.time("[Worker] 创建 KlineProcess 实例"),p=new d(m,0,t.length),console.timeEnd("[Worker] 创建 KlineProcess 实例"),console.timeEnd("[Worker] 完整初始化流程"),self.postMessage({type:"initialized"}),v&&(await x(v),v=null)}catch(e){console.error("[Worker] 初始化失败:",e),self.postMessage({type:"error",error:e instanceof Error?e.message:"未知错误",stack:e instanceof Error?e.stack:void 0})}finally{k=!1}}async function x(e){if(!p)throw Error("处理器未初始化");let{canvas:t,mainCanvas:n,overlayCanvas:r}=e;try{console.time("[Worker] 设置 Canvas"),p.set_canvases(t,n,r),console.timeEnd("[Worker] 设置 Canvas"),console.time("[Worker] 绘制 K 线图"),p.draw_all(),console.timeEnd("[Worker] 绘制 K 线图"),self.postMessage({type:"drawComplete"})}catch(e){throw console.error("[Worker] 绘制失败:",e),e}}self.onmessage=async e=>{let{data:t}=e;try{switch(t.type){case"init":await W(t);break;case"draw":if(k){v=t;return}await x(t);break;case"mousemove":if(!p)return;p.handle_mouse_move(t.x,t.y);break;case"mousedown":if(!p)return;let e=p.handle_mouse_down(t.x,t.y);self.postMessage({type:"mousedownHandled",handled:e});break;case"mouseup":let n;if(!p)return;-1===t.x&&-1===t.y&&p.handle_mouse_leave(),n=p.handle_mouse_up(t.x,t.y),self.postMessage({type:"mouseupHandled",isDragEnd:n});break;case"mousedrag":if(!p)return;p.handle_mouse_drag(t.x,t.y);break;case"mouseleave":if(!p)return;let r=p.handle_mouse_leave();self.postMessage({type:"mouseleaveHandled",needsRedraw:r});break;case"wheel":if(!p)return;p.handle_wheel(t.deltaY,t.x,t.y);break;case"getCursorStyle":if(!p)return;try{let e=p.get_cursor_style(t.x,t.y);self.postMessage({type:"cursorStyle",style:e})}catch(e){console.error("[Worker] 获取光标样式错误:",e),self.postMessage({type:"cursorStyle",style:"default"})}break;case"click":if(!p)return;let o=p.handle_click(t.x,t.y);self.postMessage({type:"clickHandled",modeChanged:o});break;default:console.error("Worker 收到未知类型的消息")}}catch(e){console.error("[Worker] 处理消息失败:",e),self.postMessage({type:"error",error:e instanceof Error?e.message:"未知错误",stack:e instanceof Error?e.stack:void 0})}},self.addEventListener("close",()=>{p&&(console.log("[Worker] 释放 KlineProcess"),p.free(),p=null),m=null,v=null})})(),_N_E={}})();