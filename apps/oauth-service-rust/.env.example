# ================================
# OAuth Service Rust - 生产环境配置示例
# ================================
# 复制此文件为 .env 并填写实际值
# 注意: .env 文件不应提交到版本控制系统

# ================================
# 数据库配置
# ================================
# SQLite (开发环境)
DATABASE_URL=sqlite:./oauth.db

# MySQL (生产环境推荐)
# DATABASE_URL=mysql://oauth_user:STRONG_PASSWORD@mysql-host:3306/oauth_db?ssl-mode=REQUIRED

# ================================
# JWT 配置
# ================================
# JWT 算法选择:
# - HS256: 开发环境,使用共享密钥
# - RS256: 生产环境,使用非对称密钥对 (推荐)
JWT_ALGORITHM=RS256

# RS256 密钥路径 (生产环境推荐)
JWT_PRIVATE_KEY_PATH=./keys/private_key.pem
JWT_PUBLIC_KEY_PATH=./keys/public_key.pem

# HS256 共享密钥 (仅用于开发环境)
# 生成强密钥: openssl rand -base64 64
# JWT_SECRET=your-super-secret-key-minimum-32-characters-long-CHANGE-THIS

# Token 签发者
# 生产环境: 使用真实的授权服务器 URL
ISSUER=https://auth.yourdomain.com

# ================================
# 应用 URL 配置
# ================================
# OAuth Service URL (通过 Pingora 代理访问)
NEXT_PUBLIC_OAUTH_SERVICE_URL=https://api.yourdomain.com

# Admin Portal URL (通过 Pingora 代理访问)
NEXT_PUBLIC_ADMIN_PORTAL_URL=https://admin.yourdomain.com

# ================================
# Token 生命周期配置
# ================================
# Access Token 有效期 (秒)
ACCESS_TOKEN_TTL=3600

# Refresh Token 有效期 (秒)
REFRESH_TOKEN_TTL=2592000  # 30 天

# Authorization Code 有效期 (秒)
AUTH_CODE_TTL=600  # 10 分钟

# Session Token 有效期 (秒)
SESSION_TOKEN_TTL=3600  # 1 小时

# ================================
# 安全配置
# ================================
# 环境模式
# 影响: Cookie Secure 属性, CORS 策略
NODE_ENV=production

# 强制 PKCE (生产环境应始终为 true)
REQUIRE_PKCE=true

# 强制同意屏幕 (可选)
REQUIRE_CONSENT=false

# 允许 localhost 重定向 (仅开发环境)
ALLOW_LOCALHOST_REDIRECT=false

# ================================
# 数据库管理
# ================================
# 跳过数据库初始化 (迁移和种子数据)
# 首次部署: false
# 后续重启: true (避免重复初始化)
SKIP_DB_INIT=false

# ================================
# 限流配置
# ================================
# 每分钟最大请求数 (per IP)
RATE_LIMIT_MAX_REQUESTS=100

# 限流时间窗口 (秒)
RATE_LIMIT_WINDOW_SECS=60

# ================================
# RBAC 配置
# ================================
# 权限缓存 TTL (秒)
PERMISSION_CACHE_TTL=300  # 5 分钟

# 权限缓存容量
PERMISSION_CACHE_CAPACITY=1000

# ================================
# 日志配置
# ================================
# 日志级别: trace, debug, info, warn, error
RUST_LOG=info

# 结构化日志格式: json | pretty
LOG_FORMAT=json

# 日志输出: stdout | file
LOG_OUTPUT=file

# 日志文件路径
LOG_FILE_PATH=./logs/oauth-service.log

# ================================
# 服务器配置
# ================================
# 监听地址
SERVER_HOST=127.0.0.1

# 监听端口
SERVER_PORT=3001

# 数据库连接池大小
DB_MAX_CONNECTIONS=10

# ================================
# CORS 配置 (生产环境)
# ================================
# 允许的来源 (逗号分隔)
CORS_ALLOWED_ORIGINS=https://admin.yourdomain.com,https://app.yourdomain.com

# 允许的方法
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS

# 允许的头部
CORS_ALLOWED_HEADERS=Content-Type,Authorization

# 允许凭证
CORS_ALLOW_CREDENTIALS=true

# ================================
# 监控和健康检查
# ================================
# 启用指标收集
ENABLE_METRICS=true

# Prometheus 指标端点
METRICS_PORT=9090

# 健康检查端点
HEALTH_CHECK_ENABLED=true

# ================================
# 邮件配置 (用于密码重置等)
# ================================
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_USERNAME=oauth@yourdomain.com
SMTP_PASSWORD=STRONG_SMTP_PASSWORD
SMTP_FROM_EMAIL=noreply@yourdomain.com
SMTP_FROM_NAME=OAuth Service

# ================================
# 审计日志配置
# ================================
# 启用审计日志
ENABLE_AUDIT_LOG=true

# 审计日志保留天数
AUDIT_LOG_RETENTION_DAYS=90

# 审计日志存储: database | file | both
AUDIT_LOG_STORAGE=both

# ================================
# 密码策略
# ================================
# 最小密码长度
PASSWORD_MIN_LENGTH=12

# 密码复杂度要求
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_DIGIT=true
PASSWORD_REQUIRE_SPECIAL=true

# 密码历史检查 (防止重复使用)
PASSWORD_HISTORY_COUNT=5

# 密码过期天数 (0 = 不过期)
PASSWORD_EXPIRY_DAYS=90

# 最大失败登录尝试次数
MAX_LOGIN_ATTEMPTS=5

# 账户锁定时长 (秒)
ACCOUNT_LOCKOUT_DURATION=1800  # 30 分钟

# ================================
# TLS/SSL 配置
# ================================
# 数据库 TLS
DATABASE_TLS_ENABLED=true
DATABASE_CA_CERT_PATH=./certs/ca.pem

# Redis TLS (如果使用)
REDIS_TLS_ENABLED=true

# ================================
# 集成服务 (可选)
# ================================
# Redis (用于分布式缓存和会话)
REDIS_URL=redis://redis-host:6379/0
REDIS_PASSWORD=STRONG_REDIS_PASSWORD

# Elasticsearch (用于日志聚合)
ELASTICSEARCH_URL=https://es-host:9200
ELASTICSEARCH_API_KEY=your-elasticsearch-api-key

# Sentry (错误追踪)
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENVIRONMENT=production

# ================================
# 特性开关
# ================================
# 启用刷新 Token 轮换
ENABLE_REFRESH_TOKEN_ROTATION=true

# 启用 ID Token (OIDC)
ENABLE_ID_TOKEN=true

# 启用 UserInfo 端点
ENABLE_USERINFO_ENDPOINT=true

# 启用 Token 内省
ENABLE_TOKEN_INTROSPECTION=true

# 启用 Token 撤销
ENABLE_TOKEN_REVOCATION=true

# ================================
# 开发者选项 (仅用于开发环境)
# ================================
# 禁用 HTTPS 强制 (仅开发环境)
# DEV_DISABLE_HTTPS=true

# 详细错误消息 (仅开发环境)
# DEV_VERBOSE_ERRORS=true

# 自动重载
# DEV_AUTO_RELOAD=true
