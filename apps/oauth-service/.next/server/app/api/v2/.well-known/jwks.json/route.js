(()=>{var e={};e.id=127,e.ids=[127],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19804:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>x,serverHooks:()=>g,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{GET:()=>f});var a=t(19227),o=t(39044),n=t(11131),i=t(57642),c=t(55212),u=t(20661),p=t(88022),l=t(68851);async function m(e){if((0,l.D2)(e))if("secret"!==e.type)return e.export({format:"jwk"});else e=e.export();if(e instanceof Uint8Array)return{kty:"oct",k:(0,p.l)(e)};if(!(0,l.R7)(e))throw TypeError((0,u.A)(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:r,key_ops:t,alg:s,use:a,...o}=await crypto.subtle.exportKey("jwk",e);return o}async function d(e){return m(e)}var y=t(43258);async function f(){try{let e,r=process.env.JWT_PUBLIC_KEY_PEM,t=process.env.JWT_KEY_ID||"default-kid",s=process.env.JWT_ALGORITHM||"RS256";if(s.startsWith("HS"))return y.A.warn("[JWKS] Symmetric algorithm configured. JWKS endpoint will serve an empty key set."),i.NextResponse.json({keys:[]},{headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=3600, must-revalidate"}});if(!r)return y.A.error("[JWKS] JWT_PUBLIC_KEY_PEM is not configured for asymmetric algorithm."),i.NextResponse.json({error:"Service misconfiguration: Public key not available.",code:"JWKS_NOT_CONFIGURED"},{status:503});try{let t=await c.jU(r,s);e=await d(t)}catch(e){return y.A.error("[JWKS] Failed to import or export public key:",{message:e.message,stack:e.stack,code:e.code}),i.NextResponse.json({error:"Service misconfiguration: Invalid public key format or algorithm mismatch.",code:"JWKS_KEY_PROCESSING_ERROR"},{status:503})}let a={keys:[{...e,kid:t,alg:s,use:"sig"}]};return i.NextResponse.json(a,{headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=3600, must-revalidate"}})}catch(e){return y.A.error("[JWKS] Unexpected error generating JWKS:",{message:e.message,stack:e.stack,name:e.name}),i.NextResponse.json({error:"Failed to generate JWKS due to an unexpected server error.",code:"INTERNAL_SERVER_ERROR"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/v2/.well-known/jwks.json/route",pathname:"/api/v2/.well-known/jwks.json",filename:"route",bundlePath:"app/api/v2/.well-known/jwks.json/route"},resolvedPagePath:"/Users/liushuo/code/ts-next-template/apps/oauth-service/app/api/v2/.well-known/jwks.json/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:v,serverHooks:g}=x;function w(){return(0,n.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:v})}},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},41204:e=>{"use strict";e.exports=require("string_decoder")},43258:(e,r,t)=>{"use strict";t.d(r,{A:()=>y});var s=t(19668),a=t.n(s);t(36344);var o=t(33873),n=t.n(o),i=t(29021),c=t.n(i);let u=n().join(process.cwd(),"logs");c().existsSync(u)||c().mkdirSync(u,{recursive:!0});let p=a().format.combine(a().format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),a().format.printf(({timestamp:e,level:r,message:t})=>`${e} [${r.toUpperCase()}]: ${t}`)),l=a().format.combine(a().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),a().format.colorize({all:!0}),a().format.printf(({timestamp:e,level:r,message:t})=>{let s=r.padEnd(15);return`ðŸ•’ ${e} | ${s} | ${t}`})),m=new(a()).transports.DailyRotateFile({filename:n().join(u,"%DATE%.log"),datePattern:"YYYY-MM-DD",maxSize:"20m",maxFiles:"14d",format:p}),d=new(a()).transports.Console({format:l}),y=a().createLogger({level:"info",transports:[d,m]})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},55727:e=>{function r(e,r,t,s){return Math.round(e/t)+" "+s+(r>=1.5*t?"s":"")}e.exports=function(e,t){t=t||{};var s,a,o,n,i=typeof e;if("string"===i&&e.length>0){var c=e;if(!((c=String(c)).length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(u){var p=parseFloat(u[1]);switch((u[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*p;case"weeks":case"week":case"w":return 6048e5*p;case"days":case"day":case"d":return 864e5*p;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*p;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*p;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*p;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:break}}}return}if("number"===i&&isFinite(e)){return t.long?(a=Math.abs(s=e))>=864e5?r(s,a,864e5,"day"):a>=36e5?r(s,a,36e5,"hour"):a>=6e4?r(s,a,6e4,"minute"):a>=1e3?r(s,a,1e3,"second"):s+" ms":(n=Math.abs(o=e))>=864e5?Math.round(o/864e5)+"d":n>=36e5?Math.round(o/36e5)+"h":n>=6e4?Math.round(o/6e4)+"m":n>=1e3?Math.round(o/1e3)+"s":o+"ms"}throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64907:()=>{},70483:()=>{},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[938,344,578],()=>t(19804));module.exports=s})();