(()=>{var e={};e.id=127,e.ids=[127],e.modules={483:()=>{},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1204:e=>{"use strict";e.exports=require("string_decoder")},1630:e=>{"use strict";e.exports=require("http")},1820:e=>{"use strict";e.exports=require("os")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3258:(e,r,t)=>{"use strict";t.d(r,{A:()=>x});var s=t(9668),o=t.n(s);t(6344);var a=t(3873),n=t.n(a),i=t(9021),p=t.n(i);let u=n().join(process.cwd(),"logs");p().existsSync(u)||p().mkdirSync(u,{recursive:!0});let c=o().format.combine(o().format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),o().format.printf(({timestamp:e,level:r,message:t})=>`${e} [${r.toUpperCase()}]: ${t}`)),l=o().format.combine(o().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),o().format.colorize({all:!0}),o().format.printf(({timestamp:e,level:r,message:t})=>{let s=r.padEnd(15);return`ðŸ•’ ${e} | ${s} | ${t}`})),m=new(o()).transports.DailyRotateFile({filename:n().join(u,"%DATE%.log"),datePattern:"YYYY-MM-DD",maxSize:"20m",maxFiles:"14d",format:c}),d=new(o()).transports.Console({format:l}),x=o().createLogger({level:"info",transports:[d,m]})},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4735:e=>{"use strict";e.exports=require("events")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4907:()=>{},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},7910:e=>{"use strict";e.exports=require("stream")},8354:e=>{"use strict";e.exports=require("util")},9021:e=>{"use strict";e.exports=require("fs")},9226:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>g,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>k});var s={};t.r(s),t.d(s,{GET:()=>f});var o=t(9227),a=t(9044),n=t(1131),i=t(7642),p=t(5212),u=t(661),c=t(5318),l=t(8851);async function m(e){if((0,l.D2)(e))if("secret"!==e.type)return e.export({format:"jwk"});else e=e.export();if(e instanceof Uint8Array)return{kty:"oct",k:(0,c.l)(e)};if(!(0,l.R7)(e))throw TypeError((0,u.A)(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:r,key_ops:t,alg:s,use:o,...a}=await crypto.subtle.exportKey("jwk",e);return a}async function d(e){return m(e)}var x=t(3258);async function f(){try{let e,r=process.env.JWT_PUBLIC_KEY_PEM,t=process.env.JWT_KEY_ID||"default-kid",s=process.env.JWT_ALGORITHM||"RS256";if(s.startsWith("HS"))return x.A.warn("[JWKS] Symmetric algorithm configured. JWKS endpoint will serve an empty key set."),i.NextResponse.json({keys:[]},{headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=3600, must-revalidate"}});if(!r)return x.A.error("[JWKS] JWT_PUBLIC_KEY_PEM is not configured for asymmetric algorithm."),i.NextResponse.json({error:"Service misconfiguration: Public key not available.",code:"JWKS_NOT_CONFIGURED"},{status:503});try{let t=await p.jU(r,s);e=await d(t)}catch(e){return x.A.error("[JWKS] Failed to import or export public key:",{message:e.message,stack:e.stack,code:e.code}),i.NextResponse.json({error:"Service misconfiguration: Invalid public key format or algorithm mismatch.",code:"JWKS_KEY_PROCESSING_ERROR"},{status:503})}let o={keys:[{...e,kid:t,alg:s,use:"sig"}]};return i.NextResponse.json(o,{headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=3600, must-revalidate"}})}catch(e){return x.A.error("[JWKS] Unexpected error generating JWKS:",{message:e.message,stack:e.stack,name:e.name}),i.NextResponse.json({error:"Failed to generate JWKS due to an unexpected server error.",code:"INTERNAL_SERVER_ERROR"},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/v2/.well-known/jwks.json/route",pathname:"/api/v2/.well-known/jwks.json",filename:"route",bundlePath:"app/api/v2/.well-known/jwks.json/route"},resolvedPagePath:"/Users/liushuo/code/ts-next-template/apps/oauth-service/app/api/v2/.well-known/jwks.json/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:k,serverHooks:g}=y;function w(){return(0,n.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:k})}},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[938,578,344],()=>t(9226));module.exports=s})();