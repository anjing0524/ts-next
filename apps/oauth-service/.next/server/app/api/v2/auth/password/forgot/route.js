"use strict";(()=>{var e={};e.id=325,e.ids=[325],e.modules={563:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>q,routeModule:()=>f,serverHooks:()=>v,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{POST:()=>x});var o=t(9227),a=t(9044),n=t(1131),i=t(7642),p=t(8891),u=t(5511),l=t.n(u),d=t(4654);t(3258),t(3117);function c(){return i.NextResponse.json({message:"If your email address exists in our system and is associated with an active account, you will receive a password reset link shortly."},{status:200})}function m(e="An unexpected error occurred."){return i.NextResponse.json({error:"server_error",message:e},{status:500})}async function x(e){let r;try{r=await e.json()}catch(e){return i.NextResponse.json({error:"invalid_request",message:"Invalid JSON request body."},{status:400})}let{email:t}=r;if(!t||"string"!=typeof t||!(t&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)))return console.warn(`Password reset attempt with invalid email format: ${t}`),c();try{let e=await p.A.user.findUnique({where:{username:t.trim().toLowerCase()}});if(e&&e.isActive){let r=l().randomBytes(32).toString("hex"),t=(0,d.L)(new Date,1);await p.A.passwordResetRequest.updateMany({where:{userId:e.id,isUsed:!1,expiresAt:{gt:new Date}},data:{isUsed:!0}}),await p.A.passwordResetRequest.create({data:{userId:e.id,token:r,expiresAt:t,isUsed:!1}});let s=`https://yourfrontend.com/reset-password?token=${r}`;console.log("---- SIMULATED EMAIL ----"),console.log(`To: ${e.username}`),console.log("From: noreply@example.com"),console.log("Subject: Password Reset Request"),console.log(`Body: Please reset your password using the following link: ${s}`),console.log("   This link will expire in 1 hour(s)."),console.log(`   Password Reset Token (for testing/logging only, DO NOT include in real email body like this): ${r}`),console.log("---- END SIMULATED EMAIL ----")}else e?e.isActive||console.log(`Password reset attempt for inactive account: ${t}`):console.log(`Password reset attempt for non-existent email: ${t}`);return c()}catch(e){if(console.error("Password forgot endpoint error:",e),e.code&&e.meta)return m("Failed to process password reset request due to a database error.");return m()}}let f=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/v2/auth/password/forgot/route",pathname:"/api/v2/auth/password/forgot",filename:"route",bundlePath:"app/api/v2/auth/password/forgot/route"},resolvedPagePath:"/Users/liushuo/code/ts-next-template/apps/oauth-service/app/api/v2/auth/password/forgot/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:w,serverHooks:v}=f;function q(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:w})}},846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1204:e=>{e.exports=require("string_decoder")},1630:e=>{e.exports=require("http")},1645:e=>{e.exports=require("net")},1820:e=>{e.exports=require("os")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3258:(e,r,t)=>{t.d(r,{A:()=>x});var s=t(9668),o=t.n(s);t(6344);var a=t(3873),n=t.n(a),i=t(9021),p=t.n(i);let u=n().join(process.cwd(),"logs");p().existsSync(u)||p().mkdirSync(u,{recursive:!0});let l=o().format.combine(o().format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),o().format.printf(({timestamp:e,level:r,message:t})=>`${e} [${r.toUpperCase()}]: ${t}`)),d=o().format.combine(o().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),o().format.colorize({all:!0}),o().format.printf(({timestamp:e,level:r,message:t})=>{let s=r.padEnd(15);return`ðŸ•’ ${e} | ${s} | ${t}`})),c=new(o()).transports.DailyRotateFile({filename:n().join(u,"%DATE%.log"),datePattern:"YYYY-MM-DD",maxSize:"20m",maxFiles:"14d",format:l}),m=new(o()).transports.Console({format:d}),x=o().createLogger({level:"info",transports:[m,c]})},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{e.exports=require("path")},4075:e=>{e.exports=require("zlib")},4631:e=>{e.exports=require("tls")},4654:(e,r,t)=>{t.d(r,{L:()=>a});var s=t(9039),o=t(5547);function a(e,r,t){return(0,s.A)(e,r*o.s0,t)}},4735:e=>{e.exports=require("events")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{e.exports=require("crypto")},5591:e=>{e.exports=require("https")},6136:e=>{e.exports=require("timers")},6330:e=>{e.exports=require("@prisma/client")},7910:e=>{e.exports=require("stream")},8354:e=>{e.exports=require("util")},9021:e=>{e.exports=require("fs")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{e.exports=require("buffer")},9551:e=>{e.exports=require("url")},9771:e=>{e.exports=require("process")}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[938,176,344,813,555],()=>t(563));module.exports=s})();