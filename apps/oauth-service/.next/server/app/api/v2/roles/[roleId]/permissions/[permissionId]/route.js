"use strict";(()=>{var e={};e.id=676,e.ids=[676],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1204:e=>{e.exports=require("string_decoder")},1637:(e,r,s)=>{s.r(r),s.d(r,{patchFetch:()=>x,routeModule:()=>R,serverHooks:()=>I,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>E});var o={};s.r(o),s.d(o,{DELETE:()=>l});var t=s(9227),i=s(9044),n=s(1131),a=s(7642),d=s(8891),u=s(4633),p=s(9776);async function m(e,r){let{roleId:s,permissionId:o}=r.params,t=e.user,i=e.ip||e.headers?.get("x-forwarded-for"),n=e.headers?.get("user-agent");console.log(`管理员 ${t?.id} 正在从角色 ${s} 移除权限 ${o}。(Admin ${t?.id} removing permission ${o} from role ${s}.)`);try{let e=await d.A.role.findUnique({where:{id:s}});if(!e)return await p.PC.logAuditEvent({actorType:t?.id?"USER":"UNKNOWN_ACTOR",actorId:t?.id||"anonymous",userId:t?.id,action:"ROLE_PERMISSION_REMOVE_FAILURE_ROLE_NOT_FOUND",status:"FAILURE",resourceType:"Role",resourceId:s,ipAddress:i,userAgent:n,errorMessage:"Role not found when attempting to remove permission.",details:JSON.stringify({permissionIdToRemove:o})}),a.NextResponse.json({message:"角色未找到 (Role not found)"},{status:404});let r=await d.A.permission.findUnique({where:{id:o}});if(!r)return await p.PC.logAuditEvent({actorType:t?.id?"USER":"UNKNOWN_ACTOR",actorId:t?.id||"anonymous",userId:t?.id,action:"ROLE_PERMISSION_REMOVE_FAILURE_PERMISSION_NOT_FOUND",status:"FAILURE",resourceType:"Permission",resourceId:o,ipAddress:i,userAgent:n,errorMessage:"Permission not found when attempting to remove from role.",details:JSON.stringify({roleId:s})}),a.NextResponse.json({message:"权限未找到 (Permission not found)"},{status:404});let u=await d.A.rolePermission.deleteMany({where:{roleId:s,permissionId:o}});if(0===u.count)return await p.PC.logAuditEvent({actorType:t?.id?"USER":"UNKNOWN_ACTOR",actorId:t?.id||"anonymous",userId:t?.id,action:"ROLE_PERMISSION_REMOVE_FAILURE_NOT_ASSIGNED",status:"FAILURE",resourceType:"RolePermission",resourceId:`${s}_${o}`,ipAddress:i,userAgent:n,errorMessage:"Permission was not assigned to this role or already removed.",details:JSON.stringify({roleName:e.name,permissionName:r.name})}),a.NextResponse.json({message:"权限未分配给此角色或已移除 (Permission not assigned to this role or already removed)"},{status:404});return await p.PC.logAuditEvent({actorType:t?.id?"USER":"UNKNOWN_ACTOR",actorId:t?.id||"anonymous",userId:t?.id,action:"ROLE_PERMISSION_REMOVE_SUCCESS",status:"SUCCESS",resourceType:"RolePermission",resourceId:`${s}_${o}`,ipAddress:i,userAgent:n,details:JSON.stringify({roleName:e.name,removedPermissionName:r.name,roleId:s,permissionId:o})}),new a.NextResponse(null,{status:204})}catch(e){return console.error(`从角色 ${s} 移除权限 ${o} 失败 (Failed to remove permission ${o} from role ${s}):`,e),await p.PC.logAuditEvent({actorType:t?.id?"USER":"UNKNOWN_ACTOR",actorId:t?.id||"anonymous",userId:t?.id,action:"ROLE_PERMISSION_REMOVE_FAILURE_DB_ERROR",status:"FAILURE",resourceType:"RolePermission",resourceId:`${s}_${o}`,ipAddress:i,userAgent:n,errorMessage:`Failed to remove permission ${o} from role ${s}.`,details:JSON.stringify({error:e.message})}),a.NextResponse.json({message:"移除角色权限失败 (Failed to remove role permission)"},{status:500})}}let l=(0,u.PS)("roles:permissions:remove")(m),R=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/v2/roles/[roleId]/permissions/[permissionId]/route",pathname:"/api/v2/roles/[roleId]/permissions/[permissionId]",filename:"route",bundlePath:"app/api/v2/roles/[roleId]/permissions/[permissionId]/route"},resolvedPagePath:"/Users/liushuo/code/ts-next-template/apps/oauth-service/app/api/v2/roles/[roleId]/permissions/[permissionId]/route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:c,workUnitAsyncStorage:E,serverHooks:I}=R;function x(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:E})}},1645:e=>{e.exports=require("net")},1820:e=>{e.exports=require("os")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{e.exports=require("path")},4075:e=>{e.exports=require("zlib")},4631:e=>{e.exports=require("tls")},4735:e=>{e.exports=require("events")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5486:e=>{e.exports=require("bcrypt")},5511:e=>{e.exports=require("crypto")},6136:e=>{e.exports=require("timers")},6330:e=>{e.exports=require("@prisma/client")},7910:e=>{e.exports=require("stream")},8354:e=>{e.exports=require("util")},9021:e=>{e.exports=require("fs")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{e.exports=require("buffer")},9551:e=>{e.exports=require("url")},9771:e=>{e.exports=require("process")}};var r=require("../../../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),o=r.X(0,[938,176,578,935,813,776,633],()=>s(1637));module.exports=o})();