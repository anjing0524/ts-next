"use strict";(()=>{var e={};e.id=371,e.ids=[371],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{e.exports=require("node:buffer")},5486:e=>{e.exports=require("bcrypt")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{e.exports=require("assert")},14985:e=>{e.exports=require("dns")},19771:e=>{e.exports=require("process")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},37067:e=>{e.exports=require("node:http")},41204:e=>{e.exports=require("string_decoder")},44708:e=>{e.exports=require("node:https")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},56154:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>U,routeModule:()=>v,serverHooks:()=>T,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{GET:()=>f,POST:()=>z});var i=t(19227),o=t(39044),n=t(11131),a=t(57642),p=t(67200),u=t(96330),l=t(91022),c=t(38738),d=t(43281);let x=p.z.object({name:p.z.string().min(1,"客户端名称不能为空").max(100,"客户端名称不能超过100个字符"),description:p.z.string().optional(),clientType:p.z.nativeEnum(u.ClientType,{errorMap:()=>({message:"客户端类型必须是PUBLIC或CONFIDENTIAL"})}),redirectUris:p.z.array(p.z.string().url("重定向URI必须是有效的URL")).min(1,"至少需要一个重定向URI"),grantTypes:p.z.array(p.z.string()).min(1,"至少需要一个授权类型"),responseTypes:p.z.array(p.z.string()).min(1,"至少需要一个响应类型"),allowedScopes:p.z.array(p.z.string()).min(1,"至少需要一个允许的权限范围"),logoUri:p.z.string().url("Logo URI必须是有效的URL").optional(),policyUri:p.z.string().url("隐私政策URI必须是有效的URL").optional(),tosUri:p.z.string().url("服务条款URI必须是有效的URL").optional(),requirePkce:p.z.boolean().optional(),requireConsent:p.z.boolean().optional(),ipWhitelist:p.z.array(p.z.string()).optional(),accessTokenTtl:p.z.number().int().positive("访问令牌TTL必须是正整数").optional(),refreshTokenTtl:p.z.number().int().positive("刷新令牌TTL必须是正整数").optional(),authorizationCodeLifetime:p.z.number().int().positive("授权码生命周期必须是正整数").optional()}),m=p.z.object({clientType:p.z.nativeEnum(u.ClientType).optional(),isActive:p.z.string().transform(e=>"true"===e).optional(),name:p.z.string().optional(),limit:p.z.string().transform(e=>parseInt(e)).pipe(p.z.number().int().positive().max(100)).optional(),offset:p.z.string().transform(e=>parseInt(e)).pipe(p.z.number().int().min(0)).optional()});async function q(e,r){let t=Object.fromEntries(new URL(e.url).searchParams.entries()),s=m.safeParse(t);if(!s.success)return a.NextResponse.json({success:!1,error:{code:"invalid_request",message:"请求参数验证失败",details:s.error.flatten().fieldErrors}},{status:400});let i=s.data;try{let e=await l.X.getClients({clientType:i.clientType,isActive:i.isActive,name:i.name,limit:i.limit,offset:i.offset});return a.NextResponse.json({success:!0,data:e,message:"客户端列表获取成功"},{status:200})}catch(e){throw e}}async function g(e,{authContext:r}){try{let t=await e.json(),s=x.safeParse(t);if(!s.success)return a.NextResponse.json({success:!1,error:{code:"invalid_request",message:"请求数据验证失败",details:s.error.flatten().fieldErrors}},{status:400});let i=s.data,o={userId:r.user_id,ipAddress:e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"},n=await l.X.createClient(i,o);return a.NextResponse.json({success:!0,data:n,message:"客户端创建成功"},{status:201})}catch(e){throw e}}let f=(0,c.Uj)((0,d.ru)(q,{requiredPermissions:["client:list"]})),z=(0,c.Uj)((0,d.ru)(g,{requiredPermissions:["client:create"]})),v=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/v2/clients/route",pathname:"/api/v2/clients",filename:"route",bundlePath:"app/api/v2/clients/route"},resolvedPagePath:"/Users/liushuo/code/ts-next-template/apps/oauth-service/app/api/v2/clients/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:h,serverHooks:T}=v;function U(){return(0,n.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:h})}},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{e.exports=require("timers")},74075:e=>{e.exports=require("zlib")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},81630:e=>{e.exports=require("http")},83997:e=>{e.exports=require("tty")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[938,176,733,200,344,706,855,281,549],()=>t(56154));module.exports=s})();