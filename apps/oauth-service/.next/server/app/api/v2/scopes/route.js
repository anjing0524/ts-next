"use strict";(()=>{var e={};e.id=174,e.ids=[174],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1204:e=>{e.exports=require("string_decoder")},1645:e=>{e.exports=require("net")},1820:e=>{e.exports=require("os")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{e.exports=require("path")},4075:e=>{e.exports=require("zlib")},4631:e=>{e.exports=require("tls")},4735:e=>{e.exports=require("events")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5486:e=>{e.exports=require("bcrypt")},5511:e=>{e.exports=require("crypto")},6136:e=>{e.exports=require("timers")},6330:e=>{e.exports=require("@prisma/client")},7422:(e,r,s)=>{s.r(r),s.d(r,{patchFetch:()=>j,routeModule:()=>h,serverHooks:()=>b,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>y});var t={};s.r(t),s.d(t,{GET:()=>g,POST:()=>q});var o=s(9227),a=s(9044),n=s(1131),i=s(7642),p=s(7200),u=s(8891),c=s(4633),l=s(6330);let d=p.z.object({name:p.z.string().min(3,"Scope name must be at least 3 characters long / 范围名称至少需要3个字符").max(100,"Scope name must be at most 100 characters long / 范围名称长度不超过100字符").regex(/^[a-zA-Z0-9_:-]+$/,"Scope name can only contain alphanumeric characters, underscores, colons, and hyphens / 范围名称只能包含字母数字、下划线、冒号和连字符"),description:p.z.string().max(500,"Description must be at most 500 characters long / 描述长度不超过500字符").optional().nullable(),isPublic:p.z.boolean().default(!1).optional(),isActive:p.z.boolean().default(!0).optional()}),x=p.z.object({page:p.z.coerce.number().int().min(1).default(1),limit:p.z.coerce.number().int().min(1).max(100).default(10),name:p.z.string().optional(),isActive:p.z.preprocess(e=>"true"===e||"false"!==e&&void 0,p.z.boolean().optional())});async function m(e){let{searchParams:r}=new URL(e.url),s={};r.forEach((e,r)=>{s[r]=e});let t=x.safeParse(s);if(!t.success)return i.NextResponse.json({error:"Validation failed",issues:t.error.issues},{status:400});let{page:o,limit:a,name:n,isActive:p}=t.data,c={};n&&(c.name={contains:n,mode:"insensitive"}),void 0!==p&&(c.isActive=p);try{let e=await u.z.scope.findMany({where:c,orderBy:{name:"asc"},skip:(o-1)*a,take:a}),r=await u.z.scope.count({where:c});return i.NextResponse.json({data:e,pagination:{page:o,pageSize:a,totalItems:r,totalPages:Math.ceil(r/a)}})}catch(e){return console.error("Failed to list scopes:",e),i.NextResponse.json({message:"Error listing scopes."},{status:500})}}let g=(0,c.PS)("scopes:list")(m);async function f(e){let r;try{r=await e.json()}catch(e){return i.NextResponse.json({error:"Invalid request body",message:"Failed to parse JSON body."},{status:400})}let s=d.safeParse(r);if(!s.success)return i.NextResponse.json({error:"Validation failed",issues:s.error.issues},{status:400});let{name:t,description:o,isPublic:a,isActive:n}=s.data;try{if(await u.z.scope.findUnique({where:{name:t}}))return i.NextResponse.json({message:`Scope name "${t}" already exists.`},{status:409});let e=await u.z.scope.create({data:{name:t,description:o,isPublic:a,isActive:n}});return i.NextResponse.json(e,{status:201})}catch(e){if(console.error("Failed to create scope:",e),e instanceof l.Prisma.PrismaClientKnownRequestError&&"P2002"===e.code)return i.NextResponse.json({message:`Scope name "${t}" already exists (race condition).`},{status:409});return i.NextResponse.json({message:"Error creating scope."},{status:500})}}let q=(0,c.PS)("scopes:create")(f),h=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/v2/scopes/route",pathname:"/api/v2/scopes",filename:"route",bundlePath:"app/api/v2/scopes/route"},resolvedPagePath:"/Users/liushuo/code/ts-next-template/apps/oauth-service/app/api/v2/scopes/route.ts",nextConfigOutput:"standalone",userland:t}),{workAsyncStorage:v,workUnitAsyncStorage:y,serverHooks:b}=h;function j(){return(0,n.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:y})}},7910:e=>{e.exports=require("stream")},8354:e=>{e.exports=require("util")},9021:e=>{e.exports=require("fs")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{e.exports=require("buffer")},9551:e=>{e.exports=require("url")},9771:e=>{e.exports=require("process")}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[938,176,578,935,200,813,776,633],()=>s(7422));module.exports=t})();