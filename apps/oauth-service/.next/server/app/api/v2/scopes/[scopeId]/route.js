"use strict";(()=>{var e={};e.id=792,e.ids=[792],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1204:e=>{e.exports=require("string_decoder")},1630:e=>{e.exports=require("http")},1645:e=>{e.exports=require("net")},1820:e=>{e.exports=require("os")},2412:e=>{e.exports=require("assert")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{e.exports=require("path")},3997:e=>{e.exports=require("tty")},4075:e=>{e.exports=require("zlib")},4252:(e,s,t)=>{t.r(s),t.d(s,{patchFetch:()=>w,routeModule:()=>h,serverHooks:()=>v,workAsyncStorage:()=>R,workUnitAsyncStorage:()=>S});var r={};t.r(r),t.d(r,{DELETE:()=>j,GET:()=>m,PATCH:()=>g});var o=t(9227),n=t(9044),a=t(1131),p=t(7642),i=t(7200),u=t(8891),c=t(9565),d=t(6330);let l=i.z.object({description:i.z.string().max(500,"描述长度不超过500字符").optional().nullable(),isPublic:i.z.boolean().optional(),isActive:i.z.boolean().optional()});async function x(e,s){let{scopeId:t}=s.params;if(!i.z.string().cuid().safeParse(t).success)return p.NextResponse.json({message:"无效的Scope ID格式 (Invalid Scope ID format)"},{status:400});try{let e=await u.z.scope.findUnique({where:{id:t}});if(!e)return p.NextResponse.json({message:"权限范围未找到 (Scope not found)"},{status:404});return p.NextResponse.json(e)}catch(e){return console.error(`获取Scope ${t} 失败:`,e),p.NextResponse.json({message:"获取Scope详情失败 (Error fetching scope details)"},{status:500})}}let m=(0,c.PS)("scopes:read")(x);async function f(e,s){let t,{scopeId:r}=s.params;if(!i.z.string().cuid().safeParse(r).success)return p.NextResponse.json({message:"无效的Scope ID格式"},{status:400});try{t=await e.json()}catch(e){return p.NextResponse.json({error:"Invalid request body",message:"Failed to parse JSON body."},{status:400})}let o=l.safeParse(t);if(!o.success)return p.NextResponse.json({error:"Validation failed",issues:o.error.issues},{status:400});let n=o.data;if(0===Object.keys(n).length)return p.NextResponse.json({message:"No fields provided for update."},{status:400});if(n.name)return p.NextResponse.json({message:"Scope name cannot be changed."},{status:400});try{let e=await u.z.scope.update({where:{id:r},data:n});return p.NextResponse.json(e)}catch(e){if(console.error(`更新Scope ${r} 失败:`,e),e instanceof d.Prisma.PrismaClientKnownRequestError&&"P2025"===e.code)return p.NextResponse.json({message:"权限范围未找到，无法更新 (Scope not found, cannot update)"},{status:404});return p.NextResponse.json({message:"更新Scope失败 (Error updating scope)"},{status:500})}}let g=(0,c.PS)("scopes:update")(f);async function q(e,s){let{scopeId:t}=s.params;if(!i.z.string().cuid().safeParse(t).success)return p.NextResponse.json({message:"无效的Scope ID格式"},{status:400});try{let e=await u.z.scope.findUnique({where:{id:t}});if(!e)return p.NextResponse.json({message:"权限范围未找到，无法删除 (Scope not found, cannot delete)"},{status:404});let s=await u.z.oAuthClient.count({where:{allowedScopes:{contains:`"${e.name}"`}}});if(s>0)return p.NextResponse.json({message:`Scope "${e.name}" is still in use by ${s} client(s) and cannot be deleted.`},{status:409});return await u.z.scope.delete({where:{id:t}}),new p.NextResponse(null,{status:204})}catch(e){if(console.error(`删除Scope ${t} 失败:`,e),e instanceof d.Prisma.PrismaClientKnownRequestError&&"P2025"===e.code)return p.NextResponse.json({message:"权限范围未找到，无法删除 (Scope not found, P2025)"},{status:404});return p.NextResponse.json({message:"删除Scope失败 (Error deleting scope)"},{status:500})}}let j=(0,c.PS)("scopes:delete")(q),h=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v2/scopes/[scopeId]/route",pathname:"/api/v2/scopes/[scopeId]",filename:"route",bundlePath:"app/api/v2/scopes/[scopeId]/route"},resolvedPagePath:"/Users/liushuo/code/ts-next-template/apps/oauth-service/app/api/v2/scopes/[scopeId]/route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:R,workUnitAsyncStorage:S,serverHooks:v}=h;function w(){return(0,a.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:S})}},4631:e=>{e.exports=require("tls")},4735:e=>{e.exports=require("events")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4985:e=>{e.exports=require("dns")},5486:e=>{e.exports=require("bcrypt")},5511:e=>{e.exports=require("crypto")},5591:e=>{e.exports=require("https")},6136:e=>{e.exports=require("timers")},6330:e=>{e.exports=require("@prisma/client")},7910:e=>{e.exports=require("stream")},8354:e=>{e.exports=require("util")},9021:e=>{e.exports=require("fs")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{e.exports=require("buffer")},9551:e=>{e.exports=require("url")},9771:e=>{e.exports=require("process")}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[938,344,176,578,434,200,470,776,565],()=>t(4252));module.exports=r})();