exports.id=300,exports.ids=[300],exports.modules={746:(e,t,s)=>{"use strict";class i{static{this.store=new Map}static{this.cleanupInterval=null}static startCleanupTimer(){this.cleanupInterval||(this.cleanupInterval=setInterval(()=>{let e=Date.now(),t=[];for(let[s,i]of this.store.entries())e-i.lastRequest>864e5&&t.push(s);t.forEach(e=>this.store.delete(e))},3e5))}static stopCleanupTimer(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}static getClientIP(e){let t=e.headers.get("x-forwarded-for");if(t){let e=t.split(",")[0];return e?e.trim():"unknown"}let s=e.headers.get("x-real-ip");if(s)return s;let i=e.headers.get("cf-connecting-ip");return i||"unknown"}static generateKey(e,t){let s,{keyType:i="ip",keyPrefix:o="rate_limit"}=t;switch(i){case"ip":default:s=this.getClientIP(e);break;case"client":let r=e.headers.get("authorization"),a=null;if(r?.includes("client_id=")){let e=r.split("client_id=")[1];e&&(a=e.split(" ")[0]||null)}let n=e.nextUrl.searchParams.get("client_id");s=a||n||this.getClientIP(e);break;case"user":let l=e.headers.get("user-agent")||"unknown";s=`${this.getClientIP(e)}-${l.slice(0,50)}`}return`${o}:${i}:${s}`}static checkRateLimit(e,t){this.startCleanupTimer();let s=Date.now(),{maxRequests:i,windowMs:o}=t,r=this.store.get(e);if(!r)return r={count:1,windowStart:s,lastRequest:s},this.store.set(e,r),{allowed:!0,remaining:i-1,resetTime:s+o,limit:i};if(s-r.windowStart>=o)return r.count=1,r.windowStart=s,r.lastRequest=s,{allowed:!0,remaining:i-1,resetTime:s+o,limit:i};if(r.lastRequest=s,r.count>=i){let e=r.windowStart+o,t=e-s;return{allowed:!1,remaining:0,resetTime:e,limit:i,retryAfter:t}}return r.count++,{allowed:!0,remaining:i-r.count,resetTime:r.windowStart+o,limit:i}}static applyRateLimit(e,t){let s=this.generateKey(e,t);return this.checkRateLimit(s,t)}static resetRateLimit(e){this.store.delete(e)}static getRateLimitStatus(e,t){let s=this.store.get(e),i=Date.now();if(!s||i-s.windowStart>=t.windowMs)return{allowed:!0,remaining:t.maxRequests,resetTime:i+t.windowMs,limit:t.maxRequests};let o=s.windowStart+t.windowMs,r=Math.max(0,t.maxRequests-s.count),a=s.count<t.maxRequests;return{allowed:a,remaining:r,resetTime:o,limit:t.maxRequests,retryAfter:a?void 0:o-i}}static clearAll(){this.store.clear()}static getRecordCount(){return this.store.size}}},4997:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=4997,e.exports=t},24958:(e,t,s)=>{"use strict";s.d(t,{z:()=>o});var i=s(96330);let o=globalThis.prisma??new i.PrismaClient},29468:(e,t,s)=>{"use strict";s.d(t,{Uj:()=>i.Uj}),s(746);var i=s(60123);s(93049)},34621:(e,t,s)=>{"use strict";s.d(t,{prisma:()=>i.z}),s(96330);var i=s(24958),o=s(50488),r=s.n(o),a=s(5433);r().config();let n={host:process.env.MYSQL_HOST||"localhost",port:parseInt(process.env.MYSQL_PORT||"3306",10),user:process.env.MYSQL_USER||"root",password:process.env.MYSQL_PASSWORD||"",database:process.env.MYSQL_DATABASE||"mydb",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0,multipleStatements:!0,charset:"utf8mb4"},l=globalThis.mysqlPool||(console.log("æ­£åœ¨åˆå§‹åŒ– MySQL è¿žæŽ¥æ± ...",{host:n.host,port:n.port,user:n.user,database:n.database}),a.createPool(n));async function c(){if(l&&!globalThis.isClosingPool)try{globalThis.isClosingPool=!0,console.log("æ­£åœ¨å…³é—­ MySQL è¿žæŽ¥æ± ..."),await l.end(),console.log("MySQL è¿žæŽ¥æ± å·²æˆåŠŸå…³é—­")}catch(e){throw console.error("å…³é—­ MySQL è¿žæŽ¥æ± æ—¶å‘ç”Ÿé”™è¯¯",e),globalThis.isClosingPool=!1,e}else globalThis.isClosingPool&&console.log("MySQL è¿žæŽ¥æ± å·²ç»åœ¨å…³é—­è¿‡ç¨‹ä¸­ï¼Œè·³è¿‡é‡å¤å…³é—­")}void 0===globalThis.isClosingPool&&(globalThis.isClosingPool=!1),process.on("SIGINT",async()=>{console.log("æŽ¥æ”¶åˆ° SIGINT ä¿¡å·ï¼Œå‡†å¤‡å…³é—­ MySQL è¿žæŽ¥æ± "),await c(),process.exit(0)}),process.on("SIGTERM",async()=>{console.log("æŽ¥æ”¶åˆ° SIGTERM ä¿¡å·ï¼Œå‡†å¤‡å…³é—­ MySQL è¿žæŽ¥æ± "),await c(),process.exit(0)}),process.on("uncaughtException",async e=>{console.error("æœªæ•èŽ·çš„å¼‚å¸¸",e),await c(),process.exit(1)})},43258:(e,t,s)=>{"use strict";s.d(t,{A:()=>h});var i=s(19668),o=s.n(i);s(36344);var r=s(33873),a=s.n(r),n=s(29021),l=s.n(n);let c=a().join(process.cwd(),"logs");l().existsSync(c)||l().mkdirSync(c,{recursive:!0});let u=o().format.combine(o().format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),o().format.printf(({timestamp:e,level:t,message:s})=>`${e} [${t.toUpperCase()}]: ${s}`)),m=o().format.combine(o().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),o().format.colorize({all:!0}),o().format.printf(({timestamp:e,level:t,message:s})=>{let i=t.padEnd(15);return`ðŸ•’ ${e} | ${i} | ${s}`})),p=new(o()).transports.DailyRotateFile({filename:a().join(c,"%DATE%.log"),datePattern:"YYYY-MM-DD",maxSize:"20m",maxFiles:"14d",format:u}),d=new(o()).transports.Console({format:m}),h=o().createLogger({level:"info",transports:[d,p]})},93049:(e,t,s)=>{"use strict";s(43258)}};