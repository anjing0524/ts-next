# ç³»ç»Ÿæ¶æ„è®¾è®¡

> **æ–‡æ¡£ç‰ˆæœ¬**: v3.1.0  
> **æœ€åæ›´æ–°**: 2025-01-26  
> **ç»´æŠ¤å›¢é˜Ÿ**: æ¶æ„ç»„  
> **é›†æˆçŠ¶æ€**: âš ï¸ 75%å®Œæˆï¼Œå­˜åœ¨å…³é”®é—®é¢˜

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†åŸºäº Turborepo çš„ OAuth2.1 è®¤è¯æˆæƒä¸­å¿ƒå’Œå¾®æœåŠ¡å¹³å°çš„ç³»ç»Ÿæ¶æ„è®¾è®¡ã€‚è¯¥æ¶æ„é‡‡ç”¨ Next.js 15 + TypeScript 5 ç°ä»£åŒ–æŠ€æœ¯æ ˆï¼Œå®ç°äº† OAuth2.1 + OIDC è®¤è¯æˆæƒä½“ç³»å’Œä¼ä¸šçº§ RBAC æƒé™ç®¡ç†ç³»ç»Ÿã€‚

**âš ï¸ å½“å‰çŠ¶æ€**: ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œä½†å­˜åœ¨å…³é”®é›†æˆé—®é¢˜éœ€è¦è§£å†³ï¼ŒåŒ…æ‹¬å®¡è®¡æ—¥å¿—ç¼ºå¤±ã€ç«¯ç‚¹è·¯å¾„ä¸åŒ¹é…ç­‰é—®é¢˜ã€‚

## æŠ€æœ¯é€‰å‹

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 15.3.2 (App Router)
- **è¯­è¨€**: TypeScript 5
- **UIåº“**: shadcn/ui + Tailwind CSS 4.1.5
- **æ•°æ®åº“**: Prisma 6.10.1 + SQLite (å¼€å‘) / PostgreSQL (ç”Ÿäº§)
- **è®¤è¯**: OAuth2.1 + JWT (jose 6.0.11)
- **æ„å»ºå·¥å…·**: Turborepo 2.5.4
- **åŒ…ç®¡ç†**: pnpm 10.6.2
- **æµ‹è¯•**: Jest 30 + @testing-library/react

### å‰ç«¯æŠ€æœ¯æ ˆ

- **çŠ¶æ€ç®¡ç†**: Zustand + Immer (flow-service)
- **è¡¨æ ¼ç»„ä»¶**: @tanstack/react-table (admin-portal)
- **å›¾è¡¨åº“**: @xyflow/react (flow-service)
- **Kçº¿å›¾**: lightweight-charts (kline-service)
- **æ‹–æ‹½**: @dnd-kit/core (flow-service)
- **WebAssembly**: flatbuffers (kline-service)

### åç«¯æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js 22
- **API**: Next.js API Routes
- **è®¤è¯**: OAuth2.1 + OIDC + PKCE
- **æƒé™**: RBAC (Role-Based Access Control)
- **åŠ å¯†**: bcrypt + jose
- **æ—¥å¿—**: winston
- **éªŒè¯**: zod

### å¼€å‘å·¥å…·

- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **ç±»å‹æ£€æŸ¥**: TypeScript
- **æµ‹è¯•**: Jest 30
- **Git Hooks**: husky + lint-staged

## å®è§‚æ¶æ„å›¾

```mermaid
graph TB
    subgraph "OAuth2.1 è®¤è¯æˆæƒä¸­å¿ƒ & å¾®æœåŠ¡å¹³å°"
        subgraph "Apps Layer - å¾®æœåŠ¡åº”ç”¨å±‚"
            A1["ğŸ” oauth-service<br/>OAuth2.1 è®¤è¯æˆæƒæœåŠ¡<br/>Port: 3001"]
            A2["ğŸ›ï¸ admin-portal<br/>ç³»ç»Ÿç®¡ç†åå°<br/>Port: 3002"]
            A3["ğŸ“ˆ kline-service<br/>Kçº¿å›¾è¡¨æœåŠ¡<br/>Port: 3003"]
            A4["ğŸ”„ flow-service<br/>å¯è§†åŒ–æµç¨‹å¼•æ“<br/>Port: 3004"]
            A5["ğŸ§ª test-service<br/>æµ‹è¯•ä¸ç¤ºä¾‹æœåŠ¡<br/>Port: 3005"]
        end

        subgraph "Packages Layer - å…±äº«åŒ…å±‚"
            P1["@repo/ui<br/>UIç»„ä»¶åº“<br/>shadcn/ui + Tailwind"]
            P2["@repo/lib<br/>å·¥å…·å‡½æ•°åº“<br/>è®¤è¯ã€éªŒè¯ã€å·¥å…·"]
            P3["@repo/database<br/>æ•°æ®åº“å±‚<br/>Prisma + SQLite"]
            P4["@repo/eslint-config<br/>ä»£ç è§„èŒƒé…ç½®"]
            P5["@repo/typescript-config<br/>TypeScripté…ç½®"]
        end
    end

    subgraph "External Systems - å¤–éƒ¨ç³»ç»Ÿ"
        DB[("ğŸ—„ï¸ SQLite Database<br/>ç”¨æˆ·ã€è§’è‰²ã€æƒé™<br/>OAuthå®¢æˆ·ç«¯")]
        CLIENT["ğŸ“± OAuth2.1 Clients<br/>ç¬¬ä¸‰æ–¹åº”ç”¨<br/>ç§»åŠ¨ç«¯/Webç«¯"]
        BROWSER["ğŸŒ Web Browser<br/>ç®¡ç†å‘˜ç•Œé¢<br/>ç”¨æˆ·æˆæƒç•Œé¢"]
    end

    %% ä¾èµ–å…³ç³»
    A1 --> P2
    A1 --> P3
    A2 --> P1
    A2 --> P2
    A2 --> P3
    A3 --> P1
    A3 --> P2
    A4 --> P1
    A4 --> P2
    A5 --> P1
    A5 --> P2
    A5 --> P3

    %% æ•°æ®æµ
    P3 --> DB
    CLIENT -.->|"OAuth2.1 Flow"| A1
    BROWSER -.->|"Admin UI"| A2
    BROWSER -.->|"Authorization"| A1
    A2 -.->|"API Calls"| A1

    %% æ ·å¼
    classDef appNode fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef pkgNode fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef extNode fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px

    class A1,A2,A3,A4,A5 appNode
    class P1,P2,P3,P4,P5 pkgNode
    class DB,CLIENT,BROWSER extNode
```

## Apps è¯¦ç»†è¯´æ˜

### ğŸ” oauth-service (ç«¯å£: 3001)

**èŒè´£**: OAuth2.1 è®¤è¯æˆæƒæœåŠ¡ - ç³»ç»Ÿæ ¸å¿ƒ

**æŠ€æœ¯æ ˆ**:

- Next.js 15.3.2 API Routes
- Prisma 6.10.1 (æ•°æ®åº“è®¿é—®)
- jose 6.0.11 (JWTå¤„ç†)
- bcrypt (å¯†ç åŠ å¯†)
- winston (æ—¥å¿—è®°å½•)
- zod (æ•°æ®éªŒè¯)

**æ ¸å¿ƒåŠŸèƒ½**:

- âœ… OAuth2.1 æˆæƒç æµç¨‹ + PKCE
- âœ… OpenID Connect (OIDC) æ”¯æŒ
- âœ… JWT Access Token å’Œ Refresh Token
- âœ… ä¼ä¸šçº§ RBAC æƒé™ç®¡ç†
- âœ… å®¢æˆ·ç«¯æ³¨å†Œå’Œç®¡ç†
- âœ… ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- âœ… Scope æƒé™æ§åˆ¶
- âš ï¸ å®¡è®¡æ—¥å¿—API (åç«¯å®ç°ç¼ºå¤±)
- âš ï¸ ç”¨æˆ·èµ„æ–™æ›´æ–°ç«¯ç‚¹ (ç¼ºå¤±)

**APIç«¯ç‚¹**:

- `/api/v2/oauth/authorize` - æˆæƒç«¯ç‚¹
- `/api/v2/oauth/token` - ä»¤ç‰Œç«¯ç‚¹
- `/api/v2/oauth/userinfo` - ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹
- `/api/v2/oauth/revoke` - ä»¤ç‰Œæ’¤é”€
- `/api/v2/users/*` - ç”¨æˆ·ç®¡ç†API
- `/api/v2/roles/*` - è§’è‰²ç®¡ç†API
- `/api/v2/clients/*` - å®¢æˆ·ç«¯ç®¡ç†API
- âŒ `/api/v2/audit-logs` - å®¡è®¡æ—¥å¿— (å¾…å®ç°)

### ğŸ›ï¸ admin-portal (ç«¯å£: 3002)

**èŒè´£**: ç³»ç»Ÿç®¡ç†åå° - è¿è¥ç®¡ç†

**æŠ€æœ¯æ ˆ**:

- Next.js 15.3.2 (App Router)
- shadcn/ui + Tailwind CSS 4.1.5
- @tanstack/react-table (æ•°æ®è¡¨æ ¼)
- zod (è¡¨å•éªŒè¯)
- @repo/ui (å…±äº«ç»„ä»¶)

**æ ¸å¿ƒåŠŸèƒ½**:

- âœ… ç”¨æˆ·ç®¡ç† (CRUD)
- âœ… è§’è‰²æƒé™ç®¡ç†
- âœ… OAuthå®¢æˆ·ç«¯ç®¡ç† (è·¯å¾„ä¸åŒ¹é…é—®é¢˜)
- âš ï¸ ç³»ç»Ÿç›‘æ§å’Œç»Ÿè®¡ (åŸºç¡€åŠŸèƒ½)
- âŒ å®¡è®¡æ—¥å¿—æŸ¥çœ‹ (åç«¯APIç¼ºå¤±)
- âŒ ç³»ç»Ÿé…ç½®ç®¡ç† (æœªå®ç°)
- âš ï¸ ä»¤ç‰Œæ’¤é”€ (logoutæœªé›†æˆ)

**é¡µé¢ç»“æ„**:

- `/admin/dashboard` - ä»ªè¡¨æ¿
- `/admin/users` - ç”¨æˆ·ç®¡ç† âœ…
- `/admin/roles` - è§’è‰²ç®¡ç† âœ…
- `/admin/clients` - OAuthå®¢æˆ·ç«¯ âš ï¸
- `/admin/audit` - å®¡è®¡æ—¥å¿— âŒ

**âš ï¸ é›†æˆé—®é¢˜**:

- å®¢æˆ·ç«¯å¯†é’¥è½®æ¢è·¯å¾„ä¸åŒ¹é…
- å®¡è®¡æ—¥å¿—åŠŸèƒ½æ— æ³•ä½¿ç”¨
- ç”¨æˆ·èµ„æ–™æ›´æ–°åŠŸèƒ½ç¼ºå¤±
- logoutæ—¶æœªè°ƒç”¨ä»¤ç‰Œæ’¤é”€

### ğŸ“ˆ kline-service (ç«¯å£: 3003)

**èŒè´£**: Kçº¿å›¾è¡¨æœåŠ¡ - æ•°æ®å¯è§†åŒ–

**æŠ€æœ¯æ ˆ**:

- Next.js 15.3.2
- lightweight-charts (å›¾è¡¨åº“)
- flatbuffers (é«˜æ€§èƒ½æ•°æ®åºåˆ—åŒ–)
- WebAssembly (æ€§èƒ½ä¼˜åŒ–)

**æ ¸å¿ƒåŠŸèƒ½**:

- ğŸ“Š å®æ—¶Kçº¿å›¾è¡¨å±•ç¤º
- âš¡ é«˜æ€§èƒ½æ•°æ®æ¸²æŸ“
- ğŸ”„ WebSocket å®æ—¶æ•°æ®
- ğŸ¨ è‡ªå®šä¹‰å›¾è¡¨æ ·å¼
- ğŸ“± å“åº”å¼è®¾è®¡

**æŠ€æœ¯ç‰¹è‰²**:

- ä½¿ç”¨ FlatBuffers ä¼˜åŒ–æ•°æ®ä¼ è¾“
- WebAssembly åŠ é€Ÿè®¡ç®—å¯†é›†å‹æ“ä½œ
- æ”¯æŒç™¾ä¸‡çº§æ•°æ®ç‚¹æ¸²æŸ“

### ğŸ”„ flow-service (ç«¯å£: 3004)

**èŒè´£**: å¯è§†åŒ–æµç¨‹å¼•æ“ - ä¸šåŠ¡æµç¨‹

**æŠ€æœ¯æ ˆ**:

- Next.js 15.3.2
- @xyflow/react (æµç¨‹å›¾)
- Zustand + Immer (çŠ¶æ€ç®¡ç†)
- @dnd-kit/core (æ‹–æ‹½åŠŸèƒ½)

**æ ¸å¿ƒåŠŸèƒ½**:

- ğŸ¨ å¯è§†åŒ–æµç¨‹è®¾è®¡å™¨
- ğŸ–±ï¸ èŠ‚ç‚¹æ‹–æ‹½å’Œè¿æ¥
- âš™ï¸ æµç¨‹æ‰§è¡Œå¼•æ“
- ğŸ’¾ æµç¨‹æ¨¡æ¿ç®¡ç†
- ğŸ“‹ æµç¨‹å®ä¾‹ç›‘æ§

**èŠ‚ç‚¹ç±»å‹**:

- å¼€å§‹/ç»“æŸèŠ‚ç‚¹
- æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹
- ç”¨æˆ·ä»»åŠ¡èŠ‚ç‚¹
- ç³»ç»Ÿä»»åŠ¡èŠ‚ç‚¹
- ç½‘å…³èŠ‚ç‚¹

### ğŸ§ª test-service (ç«¯å£: 3005)

**èŒè´£**: æµ‹è¯•ä¸ç¤ºä¾‹æœåŠ¡ - å¼€å‘æ”¯æŒ

**æŠ€æœ¯æ ˆ**:

- Next.js 15.3.2
- @repo/ui (å…±äº«ç»„ä»¶)
- @repo/database (æ•°æ®åº“è®¿é—®)
- Prisma 6.10.1

**æ ¸å¿ƒåŠŸèƒ½**:

- ğŸ”— OAuth2.1 å®¢æˆ·ç«¯é›†æˆç¤ºä¾‹
- ğŸ› ï¸ APIæµ‹è¯•å·¥å…·
- ğŸ“š å¼€å‘æ–‡æ¡£å’Œç¤ºä¾‹
- ğŸ› è°ƒè¯•å’Œè¯Šæ–­å·¥å…·
- ğŸ§ª ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹

**ç¤ºä¾‹åœºæ™¯**:

- æˆæƒç æµç¨‹æ¼”ç¤º
- PKCE æµç¨‹æ¼”ç¤º
- JWT ä»¤ç‰Œè§£æ
- RBAC æƒé™æµ‹è¯•

## Packages å…±äº«æ¶æ„

### ğŸ“¦ @repo/ui

**èŒè´£**: ç»Ÿä¸€UIç»„ä»¶åº“ - ç•Œé¢æ ‡å‡†åŒ–

**æŠ€æœ¯æ ˆ**:

- React 19.1.0 + TypeScript 5
- shadcn/ui + Tailwind CSS 4.1.5
- Radix UI (æ— éšœç¢ç»„ä»¶)
- class-variance-authority (æ ·å¼å˜ä½“)
- tailwind-merge (æ ·å¼åˆå¹¶)

**ç»„ä»¶åˆ†ç±»**:

- ğŸ¨ **åŸºç¡€ç»„ä»¶**: Button, Input, Select, Dialog, Toast
- ğŸ“‹ **è¡¨å•ç»„ä»¶**: Form, FormField, Checkbox, RadioGroup
- ğŸ“Š **æ•°æ®å±•ç¤º**: Table, Card, Badge, Avatar, Progress
- ğŸ§­ **å¯¼èˆªç»„ä»¶**: Breadcrumb, Tabs, Pagination
- ğŸ“± **å¸ƒå±€ç»„ä»¶**: Container, Grid, Flex, Separator
- ğŸ¯ **ä¸šåŠ¡ç»„ä»¶**: UserAvatar, RoleSelect, PermissionTree

**è®¾è®¡ç³»ç»Ÿ**:

- ç»Ÿä¸€çš„é¢œè‰²ä¸»é¢˜ (Light/Dark)
- å“åº”å¼æ–­ç‚¹ç³»ç»Ÿ
- æ— éšœç¢è®¿é—®æ”¯æŒ (WCAG 2.1)
- ç»„ä»¶æ–‡æ¡£å’Œ Storybook

### ğŸ› ï¸ @repo/lib

**èŒè´£**: å…±äº«å·¥å…·åº“ - ä¸šåŠ¡é€»è¾‘å¤ç”¨

**æŠ€æœ¯æ ˆ**:

- TypeScript 5 (ä¸¥æ ¼æ¨¡å¼)
- zod 3.24.1 (æ•°æ®éªŒè¯)
- date-fns (æ—¥æœŸå¤„ç†)
- crypto-js (åŠ å¯†å·¥å…·)

**åŠŸèƒ½æ¨¡å—**:

- ğŸ”§ **å·¥å…·å‡½æ•°**: æ ¼å¼åŒ–ã€éªŒè¯ã€è½¬æ¢
- ğŸ“… **æ—¥æœŸå·¥å…·**: æ—¶åŒºå¤„ç†ã€æ ¼å¼åŒ–ã€è®¡ç®—
- ğŸ” **åŠ å¯†å·¥å…·**: å“ˆå¸Œã€ç­¾åã€éšæœºæ•°ç”Ÿæˆ
- ğŸ“ **éªŒè¯æ¨¡å¼**: Zod schemas for API/Form
- ğŸ¯ **ä¸šåŠ¡å¸¸é‡**: é”™è¯¯ç ã€çŠ¶æ€ç ã€é…ç½®
- ğŸ”„ **ç±»å‹å®šä¹‰**: å…±äº« TypeScript ç±»å‹

**æ ¸å¿ƒæ¨¡å—**:

```typescript
// éªŒè¯æ¨¡å¼
export const UserSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8)
})

// å·¥å…·å‡½æ•°
export const formatCurrency = (amount: number) => ...
export const generateSecureId = () => ...
```

### ğŸ—„ï¸ @repo/database

**èŒè´£**: æ•°æ®åº“è®¿é—®å±‚ - æ•°æ®ç»Ÿä¸€ç®¡ç†

**æŠ€æœ¯æ ˆ**:

- Prisma 6.10.1 (ORM)
- SQLite (å¼€å‘ç¯å¢ƒ)
- PostgreSQL (ç”Ÿäº§ç¯å¢ƒ)
- Prisma Migrate (æ•°æ®åº“è¿ç§»)

**æ ¸å¿ƒæ¨¡å‹**:

- ğŸ‘¤ **ç”¨æˆ·ä½“ç³»**: User, Profile, UserSession
- ğŸ” **OAuth2.1**: OAuthClient, AuthorizationCode, AccessToken
- ğŸ­ **RBAC**: Role, Permission, UserRole, RolePermission
- ğŸ“Š **å®¡è®¡æ—¥å¿—**: AuditLog, LoginLog, OperationLog
- âš™ï¸ **ç³»ç»Ÿé…ç½®**: SystemConfig, ClientConfig

**æ•°æ®åº“ç‰¹æ€§**:

- ğŸ”„ è‡ªåŠ¨è¿ç§»å’Œç‰ˆæœ¬æ§åˆ¶
- ğŸ” å…¨æ–‡æœç´¢æ”¯æŒ
- ğŸ“ˆ æ€§èƒ½ç›‘æ§å’ŒæŸ¥è¯¢ä¼˜åŒ–
- ğŸ›¡ï¸ è¡Œçº§å®‰å…¨ç­–ç•¥
- ğŸ’¾ è¿æ¥æ± å’Œç¼“å­˜ä¼˜åŒ–

### âš™ï¸ é…ç½®åŒ…

**eslint-config-custom**:

- ç»Ÿä¸€çš„ä»£ç é£æ ¼è§„èŒƒ
- TypeScript ä¸¥æ ¼æ¨¡å¼
- React Hooks è§„åˆ™
- å¯¼å…¥æ’åºå’Œæ ¼å¼åŒ–

**tsconfig**:

- åŸºç¡€ TypeScript é…ç½®
- è·¯å¾„æ˜ å°„ (@repo/\*)
- ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- ç°ä»£ ES ç‰¹æ€§æ”¯æŒ

## æœåŠ¡é—´é€šä¿¡

### å½“å‰å®ç°

- **åŒæ­¥é€šä¿¡**: å¾®æœåŠ¡ä¹‹é—´é€šè¿‡ `RESTful API` è¿›è¡Œç›´æ¥è°ƒç”¨ï¼Œä½¿ç”¨ `oauth-service` ç­¾å‘çš„ `JWT` è¿›è¡Œè®¤è¯
- **å‰åç«¯é€šä¿¡**: admin-portal é€šè¿‡ HTTP API è°ƒç”¨ oauth-service
- **è®¤è¯æœºåˆ¶**: OAuth2.1 æ ‡å‡†æµç¨‹ï¼Œå¼ºåˆ¶ä½¿ç”¨ PKCE

### âš ï¸ å½“å‰é—®é¢˜

- **ç«¯ç‚¹è·¯å¾„ä¸ä¸€è‡´**: éƒ¨åˆ†APIè·¯å¾„å‰åç«¯ä¸åŒ¹é…
- **é”™è¯¯å¤„ç†**: éœ€è¦ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- **ä»¤ç‰Œç®¡ç†**: logoutæµç¨‹æœªæ­£ç¡®è°ƒç”¨ä»¤ç‰Œæ’¤é”€

### è§„åˆ’ä¸­çš„æ”¹è¿›

- **å¼‚æ­¥é€šä¿¡**: è€ƒè™‘ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ `RabbitMQ` æˆ– `Kafka`ï¼‰å¤„ç†äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥ä»»åŠ¡
- **æœåŠ¡å‘ç°**: å®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶
- **APIç½‘å…³**: ç»Ÿä¸€APIå…¥å£å’Œè·¯ç”±ç®¡ç†

## 5. Turborepo é…ç½®

`turbo.json` æ–‡ä»¶å®šä¹‰äº†ä»»åŠ¡ä¾èµ–å’Œç¼“å­˜ç­–ç•¥ï¼Œä»¥ä¼˜åŒ–æ„å»ºå’Œå¼€å‘æµç¨‹ã€‚

```json
{
  "$schema": "https://turbo.build/schema.json",
  "globalDependencies": ["**/.env.*"],
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "!.next/cache/**"]
    },
    "lint": {
      "dependsOn": ["^lint"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

## APIè®¾è®¡

### OAuth2.1ç«¯ç‚¹

#### 1. æˆæƒç«¯ç‚¹

```
GET /api/v2/oauth/authorize
```

**å‚æ•°**:

- `response_type`: å›ºå®šä¸º "code"
- `client_id`: å®¢æˆ·ç«¯ID
- `redirect_uri`: é‡å®šå‘URI
- `scope`: è¯·æ±‚çš„æƒé™èŒƒå›´
- `state`: é˜²CSRFçŠ¶æ€å‚æ•°
- `code_challenge`: PKCEæŒ‘æˆ˜ç 
- `code_challenge_method`: å›ºå®šä¸º "S256"

#### 2. ä»¤ç‰Œç«¯ç‚¹

```
POST /api/v2/oauth/token
```

**æˆæƒç æ¨¡å¼**:

```json
{
  "grant_type": "authorization_code",
  "code": "æˆæƒç ",
  "redirect_uri": "é‡å®šå‘URI",
  "client_id": "å®¢æˆ·ç«¯ID",
  "code_verifier": "PKCEéªŒè¯ç "
}
```

**å®¢æˆ·ç«¯å‡­è¯æ¨¡å¼**:

```json
{
  "grant_type": "client_credentials",
  "scope": "è¯·æ±‚çš„æƒé™èŒƒå›´"
}
```

**åˆ·æ–°ä»¤ç‰Œ**:

```json
{
  "grant_type": "refresh_token",
  "refresh_token": "åˆ·æ–°ä»¤ç‰Œ"
}
```

#### 3. ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹

```
GET /api/v2/oauth/userinfo
Authorization: Bearer {access_token}
```

#### 4. ä»¤ç‰Œæ’¤é”€ç«¯ç‚¹

```
POST /api/v2/oauth/revoke
```

### OIDCå‘ç°ç«¯ç‚¹

#### 1. é…ç½®å‘ç°

```
GET /.well-known/openid-configuration
```

#### 2. å…¬é’¥ç«¯ç‚¹

```
GET /.well-known/jwks.json
```

## å®‰å…¨æœºåˆ¶

### 1. PKCE (å¼ºåˆ¶)

- æ‰€æœ‰æˆæƒç æµç¨‹å¿…é¡»ä½¿ç”¨PKCE
- ä½¿ç”¨SHA256å“ˆå¸Œç®—æ³•
- é˜²æ­¢æˆæƒç æ‹¦æˆªæ”»å‡»

### 2. JWTå®‰å…¨

- ä½¿ç”¨RS256ç®—æ³•ç­¾å
- æ”¯æŒå…¬é’¥éªŒè¯
- åŒ…å«æ ‡å‡†å£°æ˜ (iss, aud, exp, iat, sub)

### 3. å®¢æˆ·ç«¯è®¤è¯

- æœºå¯†å®¢æˆ·ç«¯ä½¿ç”¨HTTP Basicè®¤è¯
- å…¬å¼€å®¢æˆ·ç«¯ä»…éªŒè¯client_id
- æ”¯æŒå®¢æˆ·ç«¯å¯†é’¥è½®æ¢

### 4. æƒé™æ§åˆ¶

- åŸºäºRBACæ¨¡å‹
- ç»†ç²’åº¦æƒé™æ§åˆ¶
- æ”¯æŒèµ„æºçº§åˆ«æƒé™

## å®‰å…¨è®¾è®¡

### å¯†ç å®‰å…¨

- BCryptå“ˆå¸Œå­˜å‚¨
- å¯†ç å¼ºåº¦è¦æ±‚
- å¯†ç å†å²è®°å½•
- å¼ºåˆ¶å¯†ç æ›´æ–°
- è´¦æˆ·é”å®šæœºåˆ¶
- ç™»å½•å°è¯•è®°å½•

### ä»¤ç‰Œå®‰å…¨

- JWTä½¿ç”¨RS256ç­¾å
- è®¿é—®ä»¤ç‰ŒçŸ­æœŸæœ‰æ•ˆ(15åˆ†é’Ÿ)
- åˆ·æ–°ä»¤ç‰Œé•¿æœŸæœ‰æ•ˆ(30å¤©)
- ä»¤ç‰Œæ’¤é”€æœºåˆ¶
- JTIé»‘åå•ç®¡ç†
- ä»¤ç‰Œè½®æ¢ç­–ç•¥

### ä¼ è¾“å®‰å…¨

- å¼ºåˆ¶HTTPS
- HSTSå¤´éƒ¨
- å®‰å…¨Cookieè®¾ç½®
- CSRFä¿æŠ¤
- XSSé˜²æŠ¤

### è®¿é—®æ§åˆ¶

- RBACæƒé™æ¨¡å‹
- æœ€å°æƒé™åŸåˆ™
- æƒé™ç¼“å­˜æœºåˆ¶
- IPç™½åå•æ§åˆ¶
- å®¢æˆ·ç«¯è®¤è¯

## ç¼“å­˜ç­–ç•¥

### æƒé™ç¼“å­˜

- **å†…å­˜ç¼“å­˜**: ç”¨æˆ·æƒé™ä¿¡æ¯ç¼“å­˜15åˆ†é’Ÿ
- **Redisç¼“å­˜**: åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æƒé™å…±äº«
- **ç¼“å­˜å¤±æ•ˆ**: æƒé™å˜æ›´æ—¶ä¸»åŠ¨æ¸…é™¤

### ä»¤ç‰Œç¼“å­˜

- **é»‘åå•ç¼“å­˜**: æ’¤é”€ä»¤ç‰Œçš„JTIç¼“å­˜
- **å®¢æˆ·ç«¯ä¿¡æ¯ç¼“å­˜**: OAuthå®¢æˆ·ç«¯é…ç½®ç¼“å­˜

### é…ç½®ç¼“å­˜

- **ç³»ç»Ÿé…ç½®**: å¯åŠ¨æ—¶åŠ è½½ï¼Œå˜æ›´æ—¶åˆ·æ–°
- **å®‰å…¨ç­–ç•¥**: å†…å­˜ç¼“å­˜ï¼Œå®šæœŸåŒæ­¥

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

- **ç´¢å¼•ç­–ç•¥**: å…³é”®å­—æ®µå»ºç«‹å¤åˆç´¢å¼•
- **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨PrismaæŸ¥è¯¢ä¼˜åŒ–
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥æ± ç®¡ç†

### APIä¼˜åŒ–

- **å“åº”å‹ç¼©**: Gzipå‹ç¼©
- **è¯·æ±‚é™æµ**: åŸºäºIPå’Œç”¨æˆ·çš„é™æµ
- **å¼‚æ­¥å¤„ç†**: éå…³é”®æ“ä½œå¼‚æ­¥æ‰§è¡Œ

### å‰ç«¯ä¼˜åŒ–

- **ä»£ç åˆ†å‰²**: è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²
- **é™æ€èµ„æº**: CDNåŠ é€Ÿ
- **ç¼“å­˜ç­–ç•¥**: æµè§ˆå™¨ç¼“å­˜ä¼˜åŒ–

## JWTè®¤è¯æˆæƒä½¿ç”¨è¯´æ˜

### JWTç»“æ„

#### Header

```json
{
  "alg": "RS256",
  "typ": "JWT",
  "kid": "key-id"
}
```

#### Payload (Access Token)

```json
{
  "iss": "https://auth.company.com",
  "aud": "api.company.com",
  "sub": "user-id",
  "client_id": "client-id",
  "scope": "openid profile read:users",
  "permissions": ["user:read", "user:write"],
  "iat": 1640995200,
  "exp": 1640998800,
  "jti": "token-id"
}
```

### ä»¤ç‰ŒéªŒè¯æµç¨‹

1. **è·å–å…¬é’¥**: ä» `/.well-known/jwks.json` è·å–
2. **éªŒè¯ç­¾å**: ä½¿ç”¨RS256ç®—æ³•éªŒè¯
3. **æ£€æŸ¥å£°æ˜**: éªŒè¯iss, aud, expç­‰
4. **æƒé™æ£€æŸ¥**: éªŒè¯scopeå’Œpermissions

### ä½¿ç”¨ç¤ºä¾‹

#### 1. è·å–è®¿é—®ä»¤ç‰Œ

```javascript
// æˆæƒç æ¨¡å¼
const tokenResponse = await fetch('/api/v2/oauth/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
  },
  body: new URLSearchParams({
    grant_type: 'authorization_code',
    code: authorizationCode,
    redirect_uri: redirectUri,
    client_id: clientId,
    code_verifier: codeVerifier,
  }),
});

const tokens = await tokenResponse.json();
```

#### 2. ä½¿ç”¨è®¿é—®ä»¤ç‰Œ

```javascript
const apiResponse = await fetch('/api/v2/users', {
  headers: {
    Authorization: `Bearer ${tokens.access_token}`,
  },
});
```

#### 3. åˆ·æ–°ä»¤ç‰Œ

```javascript
const refreshResponse = await fetch('/api/v2/oauth/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
  },
  body: new URLSearchParams({
    grant_type: 'refresh_token',
    refresh_token: tokens.refresh_token,
  }),
});
```

## ç®¡ç†é¡µé¢è®¾è®¡

### é¡µé¢ç»“æ„

```
ç®¡ç†æ§åˆ¶å°
â”œâ”€â”€ ä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ ç³»ç»Ÿæ¦‚è§ˆ
â”‚   â”œâ”€â”€ æ´»è·ƒç”¨æˆ·ç»Ÿè®¡
â”‚   â””â”€â”€ ä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ ç”¨æˆ·åˆ—è¡¨
â”‚   â”œâ”€â”€ åˆ›å»ºç”¨æˆ·
â”‚   â”œâ”€â”€ ç¼–è¾‘ç”¨æˆ·
â”‚   â””â”€â”€ ç”¨æˆ·æƒé™
â”œâ”€â”€ å®¢æˆ·ç«¯ç®¡ç†
â”‚   â”œâ”€â”€ å®¢æˆ·ç«¯åˆ—è¡¨
â”‚   â”œâ”€â”€ æ³¨å†Œå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ ç¼–è¾‘å®¢æˆ·ç«¯
â”‚   â””â”€â”€ å®¢æˆ·ç«¯å¯†é’¥
â”œâ”€â”€ æƒé™ç®¡ç†
â”‚   â”œâ”€â”€ è§’è‰²ç®¡ç†
â”‚   â”œâ”€â”€ æƒé™ç®¡ç†
â”‚   â””â”€â”€ æƒé™åˆ†é…
â”œâ”€â”€ å®¡è®¡æ—¥å¿—
â”‚   â”œâ”€â”€ ç™»å½•æ—¥å¿—
â”‚   â”œâ”€â”€ æ“ä½œæ—¥å¿—
â”‚   â””â”€â”€ å®‰å…¨äº‹ä»¶
â””â”€â”€ ç³»ç»Ÿè®¾ç½®
    â”œâ”€â”€ å®‰å…¨ç­–ç•¥
    â”œâ”€â”€ ä»¤ç‰Œé…ç½®
    â””â”€â”€ ç³»ç»Ÿé…ç½®
```

### é¡µé¢æƒé™è®¾è®¡

#### æƒé™çŸ©é˜µ

| é¡µé¢/åŠŸèƒ½  | è¶…çº§ç®¡ç†å‘˜ | ç”¨æˆ·ç®¡ç†å‘˜ | å®¢æˆ·ç«¯ç®¡ç†å‘˜ | å®¡è®¡å‘˜ | æ™®é€šç”¨æˆ· |
| ---------- | ---------- | ---------- | ------------ | ------ | -------- |
| ä»ªè¡¨æ¿     | âœ“          | âœ“          | âœ“            | âœ“      | âœ“        |
| ç”¨æˆ·ç®¡ç†   | âœ“          | âœ“          | âœ—            | âœ—      | âœ—        |
| å®¢æˆ·ç«¯ç®¡ç† | âœ“          | âœ—          | âœ“            | âœ—      | âœ—        |
| æƒé™ç®¡ç†   | âœ“          | âœ“          | âœ—            | âœ—      | âœ—        |
| å®¡è®¡æ—¥å¿—   | âœ“          | âœ“          | âœ“            | âœ“      | âœ—        |
| ç³»ç»Ÿè®¾ç½®   | âœ“          | âœ—          | âœ—            | âœ—      | âœ—        |

#### èœå•æƒé™é…ç½®

```typescript
const menuPermissions = {
  dashboard: ['admin:read', 'user:read'],
  userManagement: ['admin:users:read', 'admin:users:write'],
  clientManagement: ['admin:clients:read', 'admin:clients:write'],
  permissionManagement: ['admin:permissions:read', 'admin:permissions:write'],
  auditLogs: ['admin:audit:read'],
  systemSettings: ['admin:system:read', 'admin:system:write'],
};
```

## æƒé™ä½“ç³»è®¾è®¡

### RBACæ¨¡å‹

```
ç”¨æˆ· (User) â†â†’ ç”¨æˆ·è§’è‰² (UserRole) â†â†’ è§’è‰² (Role)
                                        â†“
                                   è§’è‰²æƒé™ (RolePermission)
                                        â†“
                                   æƒé™ (Permission)
```

### é¢„å®šä¹‰è§’è‰²

1. **è¶…çº§ç®¡ç†å‘˜ (super_admin)**

   - ç³»ç»Ÿæœ€é«˜æƒé™
   - å¯ç®¡ç†æ‰€æœ‰èµ„æº

2. **ç”¨æˆ·ç®¡ç†å‘˜ (user_admin)**

   - ç”¨æˆ·å’Œè§’è‰²ç®¡ç†
   - æƒé™åˆ†é…

3. **å®¢æˆ·ç«¯ç®¡ç†å‘˜ (client_admin)**

   - OAuthå®¢æˆ·ç«¯ç®¡ç†
   - å®¢æˆ·ç«¯é…ç½®

4. **å®¡è®¡å‘˜ (auditor)**

   - æŸ¥çœ‹å®¡è®¡æ—¥å¿—
   - ç”Ÿæˆåˆè§„æŠ¥å‘Š

5. **æ™®é€šç”¨æˆ· (user)**
   - åŸºæœ¬ç”¨æˆ·æƒé™
   - ä¸ªäººä¿¡æ¯ç®¡ç†

### æƒé™å‘½åè§„èŒƒ

```
æ ¼å¼: {resource}:{action}

ç¤ºä¾‹:
- user:read          # è¯»å–ç”¨æˆ·ä¿¡æ¯
- user:write         # ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
- client:read        # è¯»å–å®¢æˆ·ç«¯ä¿¡æ¯
- client:write       # ä¿®æ”¹å®¢æˆ·ç«¯ä¿¡æ¯
- admin:users:read   # ç®¡ç†å‘˜è¯»å–ç”¨æˆ·
- admin:users:write  # ç®¡ç†å‘˜ä¿®æ”¹ç”¨æˆ·
```

## éƒ¨ç½²æŒ‡å—

### ç¯å¢ƒè¦æ±‚

- Node.js 18+
- SQLite
- Redis (å¯é€‰ï¼Œç”¨äºä¼šè¯å­˜å‚¨)

### ç¯å¢ƒå˜é‡

```bash
# æ•°æ®åº“
DATABASE_URL="postgresql://user:password@localhost:5432/oauth_db"

# JWTå¯†é’¥
JWT_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"

# åº”ç”¨é…ç½®
NEXTAUTH_URL="https://auth.company.com"
NEXTAUTH_SECRET="your-secret-key"

# å®‰å…¨é…ç½®
BCRYPT_ROUNDS=12
TOKEN_ISSUER="https://auth.company.com"
TOKEN_AUDIENCE="api.company.com"
```

### éƒ¨ç½²æ­¥éª¤

1. **å®‰è£…ä¾èµ–**

```bash
npm install
```

2. **æ•°æ®åº“è¿ç§»**

```bash
npx prisma migrate deploy
npx prisma db seed
```

3. **æ„å»ºåº”ç”¨**

```bash
npm run build
```

4. **å¯åŠ¨æœåŠ¡**

```bash
npm start
```

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl https://auth.company.com/api/v2/health

# æ£€æŸ¥OIDCé…ç½®
curl https://auth.company.com/.well-known/openid-configuration

# æ£€æŸ¥å…¬é’¥ç«¯ç‚¹
curl https://auth.company.com/.well-known/jwks.json
```

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£åº”éšç³»ç»Ÿæ›´æ–°è€Œæ›´æ–°ï¼Œç¡®ä¿ä¸å®é™…å®ç°ä¿æŒä¸€è‡´ã€‚
**è”ç³»æ–¹å¼**: å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»è®¤è¯æˆæƒå›¢é˜Ÿã€‚

# ç³»ç»Ÿæ¶æ„è®¾è®¡

æœ€æ–°æ›´æ–°æ—¥æœŸï¼š2025å¹´01æœˆ15æ—¥

## 1. Turborepoå¾®æœåŠ¡æ¶æ„

### 1.1 æ¶æ„æ¦‚è§ˆ

æœ¬é¡¹ç›®åŸºäºTurborepoæ„å»ºçš„å¾®æœåŠ¡æ¶æ„ï¼Œé‡‡ç”¨Next.js 15 + shadcn/ui + Tailwind CSSæŠ€æœ¯æ ˆï¼Œå®ç°OAuth2.1è®¤è¯æˆæƒå’ŒRBACæƒé™ç®¡ç†ç³»ç»Ÿã€‚

```mermaid
graph TB
    subgraph "Turborepo Monorepo"
        subgraph "Apps åº”ç”¨å±‚"
            A[oauth-service:3001<br/>OAuth2è®¤è¯æœåŠ¡]
            B[admin-portal:3002<br/>ç®¡ç†åå°]
            C[kline-service:3003<br/>Kçº¿å›¾è¡¨æœåŠ¡]
            D[flow-service:3004<br/>æµç¨‹å›¾æœåŠ¡]
            E[test-service:3005<br/>æµ‹è¯•ä¸å…¶ä»–API]
        end

        subgraph "Packages å…±äº«å±‚"
            F[@repo/ui<br/>shadcn/uiç»„ä»¶]
            G[@repo/lib<br/>å…±äº«å·¥å…·å‡½æ•°]
            H[@repo/database<br/>Prismaæ•°æ®åº“]
            I[@repo/eslint-config<br/>ESLinté…ç½®]
            J[@repo/typescript-config<br/>TypeScripté…ç½®]
            K[@repo/tailwind-config<br/>Tailwindé…ç½®]
        end
    end

    B --> A
    C --> A
    D --> A
    E --> A

    A --> F
    A --> G
    A --> H
    B --> F
    B --> G
    B --> H
    C --> F
    C --> G
    D --> F
    D --> G
    E --> F
    E --> G
    E --> H
```

### 1.2 æœåŠ¡è¯¦ç»†è¯´æ˜

#### 1.2.1 oauth-service (ç«¯å£3001)

**åŠŸèƒ½èŒè´£ï¼š**

- OAuth2.1æˆæƒç æµç¨‹å®ç°
- JWTä»¤ç‰Œç­¾å‘ä¸éªŒè¯
- PKCEå®‰å…¨å¢å¼º
- ç”¨æˆ·è®¤è¯ä¸ä¼šè¯ç®¡ç†
- OIDCç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹

**æ ¸å¿ƒç«¯ç‚¹ï¼š**

- `GET /api/v2/oauth/authorize` - æˆæƒç«¯ç‚¹
- `POST /api/v2/oauth/token` - ä»¤ç‰Œç«¯ç‚¹
- `GET /api/v2/oauth/userinfo` - ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹
- `POST /api/v2/oauth/revoke` - ä»¤ç‰Œæ’¤é”€
- `GET /.well-known/jwks.json` - JWTéªŒè¯å…¬é’¥

#### 1.2.2 admin-portal (ç«¯å£3002)

**åŠŸèƒ½èŒè´£ï¼š**

- ç®¡ç†å‘˜ç™»å½•ç•Œé¢
- ç”¨æˆ·æƒé™ç®¡ç†
- ç³»ç»Ÿé…ç½®ç®¡ç†
- å®¡è®¡æ—¥å¿—æŸ¥çœ‹
- RBACè§’è‰²ç®¡ç†

**è®¤è¯æ–¹å¼ï¼š**

- é€šè¿‡oauth-serviceè¿›è¡ŒOAuth2è®¤è¯
- è·å–JWTä»¤ç‰Œåè®¿é—®ç®¡ç†åŠŸèƒ½
- åŸºäºæƒé™çš„ç•Œé¢æ§åˆ¶

#### 1.2.3 kline-service (ç«¯å£3003)

**åŠŸèƒ½èŒè´£ï¼š**

- Kçº¿å›¾è¡¨æ•°æ®å¤„ç†
- WASMè®¡ç®—æ¨¡å—(Rust)
- FlatBuffersæ•°æ®åºåˆ—åŒ–
- å®æ—¶å›¾è¡¨æ¸²æŸ“
- æŠ€æœ¯æŒ‡æ ‡è®¡ç®—

**æŠ€æœ¯ç‰¹ç‚¹ï¼š**

- Rust + WASMé«˜æ€§èƒ½è®¡ç®—
- OffscreenCanvaså¤šçº¿ç¨‹æ¸²æŸ“
- FlatBuffersé›¶æ‹·è´æ•°æ®ä¼ è¾“

#### 1.2.4 flow-service (ç«¯å£3004)

**åŠŸèƒ½èŒè´£ï¼š**

- å·¥ä½œæµå¯è§†åŒ–ç¼–è¾‘
- æµç¨‹å›¾æ‹–æ‹½åŠŸèƒ½
- èŠ‚ç‚¹å…³ç³»ç®¡ç†
- æµç¨‹æ‰§è¡Œå¼•æ“

**æŠ€æœ¯æ ˆï¼š**

- @xyflow/reactæµç¨‹å›¾ç»„ä»¶
- @dnd-kitæ‹–æ‹½åŠŸèƒ½
- çŠ¶æ€ç®¡ç†å’ŒæŒä¹…åŒ–

#### 1.2.5 test-service (ç«¯å£3005)

**åŠŸèƒ½èŒè´£ï¼š**

- å¼€å‘æµ‹è¯•API
- ç³»ç»Ÿå¥åº·æ£€æŸ¥
- æ€§èƒ½ç›‘æ§ç«¯ç‚¹
- å¤‡ä»½æ¢å¤ç®¡ç†
- å…¶ä»–æ‚é¡¹åŠŸèƒ½

### 1.3 å…±äº«åŒ…æ¶æ„

#### 1.3.1 @repo/ui

- shadcn/uiç»„ä»¶åº“
- ç»Ÿä¸€UIè®¾è®¡ç³»ç»Ÿ
- Tailwind CSSæ ·å¼
- å“åº”å¼ç»„ä»¶

#### 1.3.2 @repo/lib

- OAuth2å·¥å…·å‡½æ•°
- RBACæƒé™æœåŠ¡
- APIå“åº”æ ¼å¼
- é”™è¯¯å¤„ç†æœºåˆ¶
- æ—¥å¿—å·¥å…·

#### 1.3.3 @repo/database

- Prisma ORMé…ç½®
- æ•°æ®åº“è¿ç§»è„šæœ¬
- ç§å­æ•°æ®
- æ•°æ®åº“è¿æ¥æ± 

#### 1.3.4 é…ç½®åŒ…

- `@repo/eslint-config`: ç»Ÿä¸€ä»£ç è§„èŒƒ
- `@repo/typescript-config`: TypeScripté…ç½®
- `@repo/tailwind-config`: Tailwindæ ·å¼é…ç½®

### 1.4 æœåŠ¡é—´é€šä¿¡

#### 1.4.1 è®¤è¯æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant A as admin-portal
    participant O as oauth-service
    participant API as å…¶ä»–æœåŠ¡

    U->>A: è®¿é—®ç®¡ç†é¡µé¢
    A->>O: é‡å®šå‘åˆ°OAuthæˆæƒ
    U->>O: ç”¨æˆ·ç™»å½•è®¤è¯
    O->>A: è¿”å›æˆæƒç 
    A->>O: äº¤æ¢è®¿é—®ä»¤ç‰Œ
    O->>A: è¿”å›JWTä»¤ç‰Œ
    A->>API: æºå¸¦JWTè®¿é—®API
    API->>O: éªŒè¯JWTç­¾å
    O->>API: è¿”å›éªŒè¯ç»“æœ
    API->>A: è¿”å›APIå“åº”
```

#### 1.4.2 APIç½‘å…³æ¨¡å¼

- æ‰€æœ‰å¯¹å¤–æœåŠ¡é€šè¿‡nginxä»£ç†
- åŸºäºè·¯å¾„å‰ç¼€è·¯ç”±åˆ°ä¸åŒæœåŠ¡
- ç»Ÿä¸€CORSå’Œå®‰å…¨ç­–ç•¥
- è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»

### 1.5 Turborepoé…ç½®

#### 1.5.1 ä»»åŠ¡ç¼–æ’

```json
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "!.next/cache/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "lint": {
      "dependsOn": ["^lint"]
    },
    "test": {
      "dependsOn": ["^build"]
    }
  }
}
```

#### 1.5.2 ç¼“å­˜ç­–ç•¥

- æ„å»ºäº§ç‰©ç¼“å­˜
- ä¾èµ–å®‰è£…ç¼“å­˜
- æµ‹è¯•ç»“æœç¼“å­˜
- è¿œç¨‹ç¼“å­˜æ”¯æŒ
