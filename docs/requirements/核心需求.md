# OAuth 2.1 Authentication Center - Core Requirements

## Overview

Enterprise-grade OAuth 2.1 authorization server with RBAC permissions system.

## Core Requirements

### 1. Authentication Requirements

#### OAuth 2.1 Features
- **Authorization Code Flow**: Primary authentication method
- **PKCE Enforcement**: Mandatory for all clients (S256)
- **Client Credentials Flow**: For service-to-service authentication
- **Refresh Token Flow**: Automatic token renewal
- **Token Revocation**: JTI-based blacklisting

#### OIDC 1.0 Compliance
- UserInfo endpoint
- ID Token with standard claims
- JWKS endpoint for key discovery

### 2. Authorization Requirements

#### RBAC System
- **User-Role-Permission Model**: Many-to-many relationships
- **Permission Types**: API, Menu, Operation, Data
- **Permission Naming**: `resource:action` format
- **JWT Claims**: Roles and permissions embedded in tokens

#### Core Permissions
- User Management: CRUD operations
- Role Management: CRUD with permission assignments
- Client Management: OAuth client configuration
- Permission Management: Permission point administration
- Audit Management: Security event logging

### 3. Service Architecture

#### oauth-service (Port 3001)
- OAuth 2.1 API endpoints only
- JWT token generation/validation
- RBAC permission enforcement
- No UI rendering

#### admin-portal (Port 3002)
- Authentication UI (login, consent, errors)
- Management dashboard
- User/role/client management interface
- Functions as OAuth client

### 4. Data Models

#### Core Entities
- **User**: Authentication credentials and profile
- **Role**: Permission collections
- **Permission**: Granular operation permissions
- **OAuthClient**: Applications using the service
- **AccessToken/RefreshToken**: Session management
- **AuthorizationCode**: OAuth flow tokens
- **AuditLog**: Security event tracking

### 5. Security Requirements

#### OAuth 2.1 Security
- RS256 JWT signatures
- JWKS key rotation
- Redirect URI validation
- State parameter for CSRF protection

#### Data Security
- bcrypt password hashing
- Token blacklisting
- Rate limiting on auth endpoints
- Secure token storage (HttpOnly cookies)

### 6. Integration Points

#### Service Communication
- HTTP/REST APIs between services
- Shared database via Prisma
- JWT tokens for authentication
- Redirect-based OAuth flow coordination

#### External Integration
- Standard OAuth 2.1 endpoints
- OIDC discovery endpoints
- JWKS endpoint for key verification