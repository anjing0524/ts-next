# 产品需求文档 (PRD)

> **文档版本**: v5.0.0  
> **创建日期**: 2025-01-28
> **最后更新**: 2025-07-08  
> **文档状态**: 正式版  
> **维护团队**: 产品团队

## 1. 产品概述

### 1.1 产品愿景与目标

**愿景**: 打造一个专为企业内网环境设计，安全、标准、易于集成的认证授权基础设施。

**核心目标**:

- **标准化**: 提供完全遵循 OAuth 2.1 和 OpenID Connect (OIDC) 规范的认证服务。
- **安全性**: 通过强制 PKCE、企业级 RBAC 和全面的审计日志，确保企业内部应用和数据的安全。
- **易用性**: 为管理员提供直观、高效的管理后台；为开发者提供清晰、标准的集成方案。
- **可扩展性**: 基于微服务架构，支持未来新业务服务的平滑接入。

### 1.2 目标用户

| 用户角色           | 核心诉求                                                              |
| :----------------- | :-------------------------------------------------------------------- |
| **企业IT管理员**   | 统一管理内部应用和用户权限；确保系统安全合规；降低运维成本。          |
| **内网应用开发者** | 快速为新/旧应用集成标准、安全的认证功能；无需深入研究OAuth协议细节。  |
| **安全审计员**     | 监控和审计所有关键操作和访问行为；确保系统符合企业安全策略。          |
| **企业员工**       | 通过单点登录（SSO）在各内网应用间无缝切换，获得便捷、安全的登录体验。 |

### 1.3 核心价值主张

- **安全合规**: 遵循最新的 OAuth 2.1 安全最佳实践，满足企业内网严格的安全与合规要求。
- **内网优先**: 专为内网环境设计，不依赖外部服务（如公网邮件、短信），保证数据和服务的私密性。
- **统一管理**: 提供集中的用户、角色、权限和客户端管理，简化复杂的身份管理工作。
- **开发者友好**: 标准化的API和清晰的文档，降低了业务应用的集成难度和开发成本。

---

## 2. 用户故事与核心场景

### 2.1 IT管理员

- **As an** IT管理员, **I want to** 统一管理所有内网用户的账号和角色, **so that** 我可以确保权限的最小化和集中化控制。
- **As an** IT管理员, **I want to** 注册和管理所有需要接入认证系统的内部应用 (OAuth客户端), **so that** 我可以控制哪些应用可以访问我们的认证服务。
- **As an** IT管理员, **I want to** 查看详细的审计日志, **so that** 我可以追踪所有关键操作，满足合规性要求。

### 2.2 应用开发者

- **As an** 应用开发者, **I want to** 通过标准的 OAuth 2.1 流程为我的应用快速集成��户认证功能, **so that** 我不必自己实现复杂的认证逻辑。
- **As an** 应用开发者, **I want to** 使用 JWT 令牌中包含的权限信息来控制应用内的功能访问, **so that** 我可以轻松实现基于角色的访问控制。

### 2.3 企业员工

- **As an** 企业员工, **I want to** 只登录一次就可以访问所有我被授权的内部应用, **so that** 我可以提高工作效率，无需记忆多套密码。
- **As an** 企业员工, **I want to** 在授权新应用时，清楚地看到它将请求哪些权限, **so that** 我可以做出明智的授权决定。

---

## 3. 功能需求详述

### 3.1 `oauth-service`: 认证授权核心服务

| 功能模块               | 需求描述                                                                            | 优先级 |
| :--------------------- | :---------------------------------------------------------------------------------- | :----- |
| **OAuth 2.1 授权流程** | 提供完整的授权码（Authorization Code）流程，并强制所有客户端使用 PKCE (S256) 增强。 | **P0** |
| **OIDC 支持**          | 支持 OpenID Connect 协议，提供 UserInfo 端点和 ID Token。                           | **P0** |
| **令牌管理**           | 负责 Access Token 和 Refresh Token 的颁发、刷新、验证和撤销。                       | **P0** |
| **客户端管理 API**     | 提供对 OAuth 客户端进行增删改查（CRUD）的 API 接口。                                | **P0** |
| **用户管理 API**       | 提供对用户进行增删改查（CRUD）的 API 接口。                                         | **P0** |
| **RBAC 管理 API**      | 提供对角色（Role）和权限（Permission）进行增删改查及关联的 API 接口。               | **P0** |
| **JWKS 端点**          | 通过 `/.well-known/jwks.json` 动态发布用于 JWT 签名的公钥。                         | **P0** |
| **安全审计**           | 记录所有关键操作（如登录、授权、令牌颁发、权限变更）的详细审计日志。                | **P1** |

### 3.2 `admin-portal`: 系统管理后台

| 功能模块           | 需求描述                                                                      | 优先级 |
| :----------------- | :---------------------------------------------------------------------------- | :----- |
| **统一登录页**     | 提供一个统一的、安全的登录界面，所有管理操作和需要认证的应用都将重定向至此。  | **P0** |
| **仪表盘**         | 展示核心系统状态，如在线用户数、活跃客户端数、令牌颁发统计等。                | **P1** |
| **用户管理界面**   | 可视化地创建、查看、更新和禁用用户账户。支持批量操作。                        | **P0** |
| **角色管理界面**   | 可视化地创建、配置角色，并为角色分配具体的权限。                              | **P0** |
| **权限管理界面**   | 查看系统中所有已定义的权限点。                                                | **P1** |
| **客户端管理界面** | 可视化地注册和管理 OAuth 客户端，包括生成/轮换密钥、配置重定向URI和授权范围。 | **P0** |
| **审计日志查看器** | 提供一个界面来搜索、过滤和查看系统审计日志。                                  | **P1** |
| **个人资料页**     | 允许当前登录的管理员修改自己的显示名称、密码等信息。                          | **P2** |

---

## 4. 非功能性需求

| 类别         | 需求描述                                                                                                                                                         |
| :----------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **性能**     | - 认证授权核心流程（如令牌颁发、验证）的 P99 响应时间应低于 200ms。<br>- 管理后台页面加载时间应低于 2 秒。                                                       |
| **安全性**   | - 遵循 OWASP Top 10 安全风险防范指南。<br>- 所有密码和敏感配置必须加密存储。<br>- 防止常见的 Web 攻击，如 XSS, CSRF, SQL注入等。<br>- 依赖库需定期进行漏洞扫描。 |
| **可用性**   | - 核心认证服务可用性需达到 99.99%。<br>- 支持通过容器化（Docker）进行高可用部署。                                                                                |
| **可维护性** | - 代码必须遵循项目定义的编码规范。<br>- 核心业务逻辑必须有单元测试覆盖，覆盖率不低于85%。<br>- 所有公开的 API 都必须有对应的文档说明。                           |
| **兼容性**   | - 管理后台需兼容最新版本的 Chrome、Firefox 和 Edge 浏览器。                                                                                                      |

---

## 5. 未来展望 (Out of Scope for v1)

- **多因素认证 (MFA)**: 集成 TOTP 或其他二次验证方式。
- **社交登录**: 支持通过企业微信、钉钉等内部社交平台登录。
- **更高级的权限模型**: 支持 ABAC（基于属性的访问控制）。
- **国际化 (i18n)**: 支���多语言界面。
- **自动化运维**: 提供更丰富的监控指标和一键部署脚本。
