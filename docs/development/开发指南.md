# 开发指南

## 快速开始

### 环境准备
```bash
# 安装依赖
pnpm install

# 初始化数据库
pnpm db:generate && pnpm db:push && pnpm db:seed

# 启动开发服务
pnpm dev
```

### 服务端口
- oauth-service: 3001
- admin-portal: 3002
- kline-service: 3003
- pingora-proxy: 6188

## 核心开发流程

### 1. 添加新权限
1. 在数据库seed中添加权限定义
2. 更新权限映射表
3. 前端添加权限检查
4. 更新角色权限分配

### 2. 添加新API端点
1. 创建API路由文件
2. 实现业务逻辑
3. 添加权限中间件
4. 编写测试用例

### 3. 添加新页面
1. 创建页面组件
2. 添加路由配置
3. 实现权限控制
4. 集成API调用

## 代码规范

### TypeScript
- 严格类型检查
- 接口定义清晰
- 避免any类型
- 使用泛型提高复用性

### API设计
- RESTful风格
- 统一错误处理
- 参数验证
- 响应格式一致

### 组件开发
- 函数式组件
- 自定义Hook
- Props类型定义
- 单一职责原则

## 测试指南

### 单元测试
```bash
# 运行所有测试
pnpm test

# 运行特定服务测试
pnpm --filter=oauth-service test
```

### E2E测试
```bash
# 安装Playwright
pnpm playwright install

# 运行E2E测试
pnpm e2e
```

## 部署指南

### Docker部署
```bash
# 构建镜像
docker build -t oauth-service .

# 运行容器
docker run -p 3001:3001 oauth-service
```

### 环境变量
```bash
DATABASE_URL="file:./dev.db"
JWT_PRIVATE_KEY_PATH="./test-private.pem"
REDIS_URL="redis://localhost:6379"
NEXTAUTH_URL="http://localhost:3002"
```

## 常见问题

### 数据库迁移
```bash
# 创建迁移
pnpm db:generate

# 应用迁移
pnpm db:push

# 重置数据库
pnpm db:reset
```

### JWT令牌问题
- 检查密钥路径配置
- 确认JWKS端点可访问
- 验证令牌签名算法

### 权限问题
- 检查角色权限分配
- 确认JWT包含权限声明
- 验证中间件配置