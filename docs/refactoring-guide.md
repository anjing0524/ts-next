# OAuth Service 重构与安全加固指南

**版本**: 1.0  
**状态**: 进行中  
**日期**: 2024-07-29

## 1. 背景与目标

### 1.1 背景

当前 `oauth-service` 服务的实现与项目设计文档存在较大差异。具体表现为：

- **文档过时**: `docs` 目录下的设计文档（特别是 `Prisma` schema）与线上代码严重脱节。
- **安全缺失**: 核心管理API端点普遍缺乏基于RBAC的权限校验，存在严重安全隐患。
- **代码冗余**: 代码中可能存在Swagger等不再使用的相关内容。

### 1.2 目标

本次重构旨在解决上述问题，核心目标包括：

- **增强安全性**: 为所有管理API端点应用严格的、基于角色的权限控制。
- **同步文档**: 使项目文档（代码级、设计级）与当前实现保持一致。
- **提升质量**: 移除无用代码，优化核心服务性能，提高代码可维护性。

## 2. 重构阶段与任务

### 阶段一：规划与文档准备

- ✅ **任务1**: 创建本重构指南。
- ⬜ **任务2**: 更新文档索引和链接 (`packages/lib/README.md`, `docs/README.md`)。

### 阶段二：核心功能增强

- ⬜ **任务3**: 通过缓存增强 `RBACService` 的性能。
- ⬜ **任务4**: 创建统一的权限检查中间件 `withPermissionCheck`。

### 阶段三：安全加固与重构

- ⬜ **任务5**: 将权限中间件应用于所有管理API端点。
- ⬜ **任务6**: 移除所有 `Swagger/OpenAPI` 相关内容。

### 阶段四：最终化与总结

- ⬜ **任务7**: 最终化本文档，并提出核心设计文档的合并与更新计划。

## 3. 具体任务详情

_(此部分将在各任务执行时填充)_

---
