# 项目依赖索引（2025-06-26）

> 本文档基于当前仓库结构自动生成，用于帮助开发者快速了解 monorepo 中各应用（apps/*）与子包（packages/*）的依赖关系、导出内容及按需引用方式。

## 目录

1. 总览
2. Apps 索引
3. Packages 索引
4. 依赖关系图
5. 按需引用指南
6. TypeScript 别名共享方案（2025-06-26 更新）

---

## 1. 总览

- **包管理器**：pnpm + Turborepo
- **前端框架**：Next.js 15 + TailwindCSS 4 + shadcn/ui
- **数据库**：Prisma + SQLite
- **测试框架**：Jest 30

项目根目录简化结构：

```bash
.
├── apps/            # 微服务应用
├── packages/        # 共享包（UI、Lib、Database…）
├── docs/            # 文档
└── turbo.json       # Turborepo 配置
``` 

## 2. Apps 索引

| 应用 | 默认端口 | 主要功能 | 依赖内部包 |
|------|----------|----------|-------------|
| **oauth-service** | 3001 | OAuth2 授权中心，提供授权码、PKCE、客户端凭证等流程；管理权限 / 角色 / Scope API。 | `@repo/ui` · `@repo/lib` · `@repo/database` |
| **admin-portal** | 3002 | 后台管理前端，面向管理员的 UI，可管理用户、角色、审计日志等。 | `@repo/ui` · `@repo/lib` · `@repo/database` |
| **kline-service** | 3003 | K 线图渲染与 WebAssembly 计算服务；FlatBuffers 数据接口。 | `@repo/ui` · `@repo/lib` |
| **flow-service** | 3004 | 流程编排与 DAG 可视化；提供流程节点拖拽、状态监控。 | `@repo/ui` · `@repo/lib` |
| **test-service** | 3005 | 用于集成测试 / 健康检查 & SSE 示例。 | `@repo/ui` · `@repo/lib` · `@repo/database` |

> 约定：所有 Next.js 应用的端口可在各自 `package.json` 的 `dev` / `start` 脚本中通过 `-p` 参数调整。

## 3. Packages 索引

| 包 | 说明 | 入口文件 / 导出概览 |
|----|------|--------------------|
| **@repo/ui** | 共享 UI 组件库，基于 shadcn/ui 与 TailwindCSS。 | `src/index.ts` → `components.ts`：Alert／Button／Table／Dashboard blocks 等 30+ 组件；`hooks/`；`lib/utils.ts` |
| **@repo/lib** | 业务逻辑 & 工具库。提供 OAuth2 / JWT / RBAC 等工具与服务。 | `src/index.ts`：`auth/*`、`services/*`、`utils/*`、`middleware/*`，以及 `LIB_VERSION` 常量 |
| **@repo/database** | Prisma 客户端封装，提供数据库访问与数据类型。 | `client.ts`、`mysql-client.ts`、`prisma/schema.prisma` |
| **@repo/cache** | 简易缓存工具与日志封装。 | `src/cache-manager.ts`、`src/logger.ts` |
| **@repo/eslint-config** | 共享 ESLint Flat 配置。 | `flat.js` |
| **@repo/jest-config** | 共享 Jest 30 配置。 | `index.js`、`next.js` |
| **@repo/prettier-config** | 共享 Prettier 配置。 | `index.js` |
| **@repo/tailwind-config** | 共享 Tailwind v4 + shadcn preset。 | `postcss.config.mjs`、`shared-styles.css` |
| **@repo/next-config** | 统一 Next.js (15) 配置扩展。 | `index.js` |
| **@repo/typescript-config** | TypeScript base / Next.js tsconfig 片段。 | `base.json`、`nextjs.json` |

> 如需详细导出，请查看对应包下的 README（将在后续 PR 中补充）。

## 4. 依赖关系图

```mermaid
graph TD;
  subgraph Apps
    oauth[oauth-service];
    admin[admin-portal];
    kline[kline-service];
    flow[flow-service];
    test[test-service];
  end
  subgraph Packages
    ui[@repo/ui];
    lib[@repo/lib];
    db[@repo/database];
  end

  oauth --> ui;
  oauth --> lib;
  oauth --> db;
  admin --> ui;
  admin --> lib;
  admin --> db;
  kline --> ui;
  kline --> lib;
  flow --> ui;
  flow --> lib;
  test --> ui;
  test --> lib;
  test --> db;

  lib --> db;
```

Mermaid 渲染示例：

![dependency-graph](./images/dependency-graph-20250626.png)

> 若在 GitHub 上无法直接渲染，请安装支持 Mermaid 的浏览器插件或在本地 VSCode 预览。

## 5. 按需引用指南

1. **在 App 中引用 UI 组件**
   ```tsx
   import { Button, Alert } from '@repo/ui';
   ```
2. **使用业务库工具**
   ```ts
   import { generateAccessToken } from '@repo/lib/auth';
   import { RBACService } from '@repo/lib/services';
   ```
3. **数据库访问（Server 侧）**
   ```ts
   import { prisma } from '@repo/database';
   const users = await prisma.user.findMany();
   ```
4. **共享配置包** 在各包 `package.json` 中以 `workspace:*` 方式依赖；在根或子项目中：
   ```jsonc
   "eslintConfig": {
     "extends": ["@repo/eslint-config"]
   }
   ```
5. **Turborepo 任务** 示例（根目录 `package.json`）：
   ```jsonc
   {
     "scripts": {
       "dev": "turbo run dev --parallel",
       "build": "turbo run build",
       "test": "turbo run test"
     }
   }
   ```

> 以上示例仅供参考，更多细节请查阅各包 README 与具体源码。

## 6. TypeScript 别名共享方案（2025-06-26 更新）

自本次更新起，所有 Next.js 应用的 `tsconfig.json` 不再单独维护 `paths`，统一继承 `@repo/typescript-config/nextjs.json`。该共享配置内预设常用别名，支持根目录及 `src/` 两种组织形式，示例：

```jsonc
{
  "extends": "@repo/typescript-config/nextjs.json",
  "compilerOptions": {
    "baseUrl": "."
  }
}
```

共享配置关键片段：

```jsonc
"paths": {
  "@/*":       ["./*", "./*"],
  "@/app/*":   ["./app/*", "./app/*"],
  "@/components/*": ["./components/*", "./components/*"],
  "@/lib/*":   ["./lib/*", "./lib/*"]
}
```

> 如果应用需要额外别名，可在自身 `compilerOptions.paths` 中追加（优先级高于共享配置）。 